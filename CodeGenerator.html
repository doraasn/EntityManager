<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>实体类管理</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <style>
    textarea#jsonInput:focus {
      border-color: var(--primary-color);
      outline: none;
    }

    textarea#jsonInput {
      width: 100%;
      height: 410px;
      padding: .75rem;
      border: 1px solid var(--border-color);
      background: var(--bg-color);
      color: var(--text-secondary);
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: .875rem;
      line-height: 1.6;
      resize: vertical;
      transition: border-color var(--transition-fast);
      border-radius: 6px;
    }

    select option:focus {
      background: var(--nav-bg-1);
      color: var(--primary-color);
    }

    select option:checked {
      background: var(--nav-bg-1);
      color: var(--primary-color);
      font-weight: 500;
    }

    select option {
      padding: .5rem 1rem;
      border: none;
      background: #fff;
      color: var(--text-primary);
      font-size: .92em;
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 4px;
    }

    pre.code-area {
      overflow-x: auto;
      flex: 1;
      height: 400px;
      margin: 0;
      padding: 1.5rem;
      background: white !important;
      color: #2a9d8f;
      font-family: 'Microsoft YaHei', 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: .875rem;
      line-height: 1.6;
    }

    button:hover {
      transform: translateY(var(--button-hover-lift));
    }

    button:active {
      transform: translateY(1px);
    }

    button {
      height: 36px;
      padding: .5rem 1rem;
      border: none;
      color: white;
      font-size: .875rem;
      font-weight: 500;
      line-height: 1;
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 6px;
    }

    body {
      min-height: 100vh;
      padding: 1rem;
      background: var(--bg-color);
      color: var(--text-primary);
      font-family: 'Microsoft YaHei', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      animation: fadeIn var(--transition-normal) ease-out;
    }

    #mainConfigSelector {
      display: inline-block;
      position: relative;
      width: 400px;
      min-width: 400px;
      max-width: 400px;
    }

    #mainConfigSelector .config-select-options.show {
      visibility: visible;
      opacity: 1;
      transform: translateY(0);
    }

    #mainConfigSelector .config-select-options {
      visibility: hidden;
      position: absolute;
      z-index: 101;
      top: calc(100% + 4px);
      left: 0;
      width: 400px;
      min-width: 400px;
      max-width: 400px;
      margin: 0;
      padding: 0 !important;
      background: var(--dropdown-bg);
      opacity: 0;
      transition: all var(--transition-fast);
      transform: translateY(-10px);
      border-radius: var(--dropdown-radius);
      box-shadow: var(--dropdown-shadow);
    }

    #mainConfigSelector .config-select-header.active::after {
      color: var(--dropdown-arrow-hover);
    }

    #mainConfigSelector .config-select-header.active {
      border-color: var(--dropdown-hover-border);
    }

    #mainConfigSelector .config-select-header::after {
      content: '▼';
      margin-left: .5rem;
      color: var(--dropdown-arrow);
      font-size: .75rem;
      transition: color var(--transition-fast), transform var(--transition-fast);
    }

    #mainConfigSelector .config-select-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 400px;
      height: 36px;
      padding: .5rem 1rem;
      border: 1px solid var(--dropdown-border);
      background: #f8fafc;
      color: var(--primary-color);
      font-size: 1rem;
      font-weight: 600;
      line-height: 1;
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: var(--dropdown-radius);
    }

    #mainConfigSelector .config-option.selected {
      background: var(--dropdown-hover-bg);
      color: var(--primary-color);
      font-weight: 700;
    }

    #mainConfigSelector .config-option:last-child {
      border-radius: 0 0 var(--dropdown-radius) var(--dropdown-radius);
    }

    #mainConfigSelector .config-option:hover {
      background: var(--dropdown-hover-bg);
      color: var(--primary-color);
    }

    #mainConfigSelector .config-option:first-child {
      border-radius: var(--dropdown-radius) var(--dropdown-radius) 0 0;
    }

    #mainConfigSelector .config-option {
      display: flex;
      align-items: center;
      width: 400px;
      min-height: 32px;
      padding: .5rem 1rem;
      border: none;
      background: transparent;
      color: var(--text-primary);
      font-size: .92rem;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 0;

      gap: .5rem;
    }

    #instructionModal .rules-list p {
      margin-bottom: 1.2rem;
    }

    #instructionModal .rules-list code {
      padding: .18rem .5rem;
      background: #f0f9ff;
      color: var(--primary-color);
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: .98rem;
      border-radius: 4px;
    }

    #instructionModal .rules-list {
      padding: 0;
      color: var(--text-secondary);
      font-size: .95rem;
      line-height: 1.7;
    }

    #instructionModal .modal-header {
      flex-shrink: 0;
      margin-bottom: 1.5rem;
      color: var(--primary-color);
      font-size: 1.25rem;
      font-weight: 700;
      text-align: center;
    }

    #instructionModal .modal-content {
      overflow: hidden;
      display: flex;
      flex-direction: column;
      max-width: 700px;
      max-height: 90vh;
      margin: 0 auto;
      padding: 2.5rem 2rem;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 8px 32px rgba(59, 130, 246, .15);
    }

    #instructionModal .modal-body {
      overflow-y: auto;
      flex: 1;
      max-height: calc(90vh - 200px);
      padding-right: 10px;
    }

    #instructionModal .modal-body::-webkit-scrollbar {
      width: 8px;
    }

    #instructionModal .modal-body::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    #instructionModal .modal-body::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }

    #instructionModal .modal-body::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }

    #importJsonModal .modal-header {
      margin-bottom: 1.2rem;
      color: var(--primary-color);
      font-size: 1.15rem;
      font-weight: 600;
      text-align: center;
    }

    #importJsonModal .modal-footer {
      display: flex;
      justify-content: flex-end;

      gap: 1rem;
    }

    #importJsonModal .modal-content {
      display: flex;
      align-items: stretch;
      flex-direction: column;
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
      padding: 2.5rem 2rem;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 8px 32px rgba(59, 130, 246, .15);
    }

    #importJsonModal .modal-body textarea {
      width: 100%;
      min-height: 120px;
      margin-bottom: 1.2rem;
      padding: .75rem;
      border: 1px solid var(--border-color);
      background: #f8fafc;
      color: var(--text-primary);
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: .95rem;
      resize: vertical;
      border-radius: 6px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    @media (max-width: 800px) {
      .entity-table-header {
        align-items: flex-start;
        flex-direction: column;
        padding: .7rem .5rem;
      }

      .fields-table {
        min-width: 350px;
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 0 1rem;
      }

      .button-group {
        flex-wrap: wrap;
      }

      .toast {
        width: calc(100vw - 2rem);
        min-width: auto;
      }

      .nav-group {
        align-items: flex-start;
        flex-direction: column;
      }
    }

    @media (max-width: 600px) {

      .entity-table-card,
      .input-section {
        max-width: 100vw;
        padding: 0 .2rem;
      }

      .fields-table {
        min-width: 200px;
      }
    }

    @media (max-width: 600px) {
      .back-to-top-fixed {
        right: 12px;
        bottom: 12px;
      }

      .back-to-top-fixed .back-to-top {
        width: 40px;
        height: 40px;
        border-radius: 8px;
      }

      .back-to-top-fixed .back-to-top svg {
        width: 22px;
        height: 22px;
      }
    }

    @media (max-width: 1200px) {
      .files-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 1200px) {

      .entity-table-card,
      .input-section {
        max-width: 100vw;
        padding: 0 .5rem;
      }

      .fields-table {
        min-width: 500px;
      }
    }

    @media (max-width: 1200px) {
      .config-section {
        grid-template-columns: 1fr;
        gap: 2rem;
      }
    }

    @keyframes slideOutLeft {
      from {
        opacity: 1;
        transform: translateX(0);
      }

      to {
        opacity: 0;
        transform: translateX(-80px);
      }
    }

    @keyframes slideOut {
      from {
        opacity: 1;
        transform: translateX(0);
      }

      to {
        opacity: 0;
        transform: translateX(-80px);
      }
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-80px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-80px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(-50%) translateX(0);
      }

      25% {
        transform: translateX(-50%) translateX(-5px);
      }

      75% {
        transform: translateX(-50%) translateX(5px);
      }
    }

    @keyframes rowMove {
      0% {
        transform: scale(1) translateX(0);
      }

      20% {
        transform: scale(1.04) translateX(-8px);
      }

      40% {
        transform: scale(.98) translateX(6px);
      }

      60% {
        transform: scale(1.02) translateX(-4px);
      }

      80% {
        transform: scale(1) translateX(2px);
      }

      100% {
        transform: scale(1) translateX(0);
      }
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }

      100% {
        transform: scale(1);
      }
    }

    @keyframes moveUp {
      0% {
        transform: translateY(0);
      }

      100% {
        transform: translateY(-100%);
      }
    }

    @keyframes moveDown {
      0% {
        transform: translateY(0);
      }

      100% {
        transform: translateY(100%);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes btnBounce {
      0% {
        transform: scale(1);
      }

      40% {
        transform: scale(1.18);
      }

      60% {
        transform: scale(.92);
      }

      100% {
        transform: scale(1);
      }
    }

    [data-tooltip]:hover:after {
      visibility: visible;
      opacity: 1;
    }

    [data-tooltip]:before {
      content: attr(data-tooltip);
      visibility: hidden;
      position: absolute;
      z-index: 1000;
      bottom: calc(100% + 10px);
      left: 50%;
      padding: .5rem 1rem;
      background: rgba(0, 0, 0, .8);
      color: white;
      font-size: .75rem;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      transition: all var(--transition-fast);
      transform: translateX(-50%);
      border-radius: 4px;
      box-shadow: var(--shadow-sm);
    }

    [data-tooltip]:after {
      padding: .3rem .7rem !important;
      border-top-color: #2563eb !important;
      border-bottom-color: #2563eb !important;
      background: #2563eb !important;
      color: #fff !important;
      font-size: .72rem !important;
      border-radius: 4px !important;
    }

    [data-tooltip] {
      position: relative;
      cursor: pointer;
    }

    .type-sql {
      display: flex;
      align-items: center;
      height: 36px;
      background: #fff8f0;
      color: #e38c00;
    }

    .type-select-container select {
      flex: 1;
    }

    .type-select-container input.show {
      display: block;
    }

    .type-select-container input {
      display: none;
      flex: 1;
    }

    .type-select-container {
      display: flex;
      align-items: center;

      gap: 4px;
    }

    .type-select-container .config-selector {
      min-width: 150px;
      max-width: 150px;
    }

    .type-select-container .config-select-header {
      min-width: 150px;
      max-width: 150px;
      padding: 0 .5rem;
      text-align: left;
    }

    .type-java {
      display: flex;
      align-items: center;
      height: 36px;
      background: #f8f4f0;
      color: #b07219;
    }

    .tr-move-up {
      animation: moveUp .3s;
    }

    .tr-move-down {
      animation: moveDown .3s;
    }

    .tooltip-top::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      border: 6px solid transparent;
      border-top-color: #2563eb;
      transform: translateX(-50%);
    }

    .tooltip-top {
      bottom: 100%;
      left: 50%;
      margin-bottom: 10px;
      transform: translateX(-50%) translateY(5px);
    }

    .tooltip-error::after {
      border-bottom-color: var(--error-color);
    }

    .tooltip-error {
      background: var(--error-color);
      cursor: pointer;
      user-select: text;
      animation: shake .5s ease-in-out;
    }

    .tooltip-container.error .tooltip-top {
      visibility: hidden;
      opacity: 0;
    }

    .tooltip-container.error .tooltip-error {
      visibility: visible;
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .tooltip-container:not(.error):hover .tooltip-top {
      visibility: visible;
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .tooltip-container {
      display: inline-block;
      position: relative;
    }

    .tooltip-bottom::after {
      content: '';
      position: absolute;
      bottom: 100%;
      left: 50%;
      border: 4px solid transparent;
      border-bottom-color: rgba(0, 0, 0, .6);
      transform: translateX(-50%);
    }

    .tooltip-bottom {
      top: 100%;
      left: 50%;
      margin-top: 10px;
      transform: translateX(-50%) translateY(-5px);
    }

    .tooltip {
      visibility: hidden;
      position: absolute;
      z-index: 9999;
      padding: .3rem .7rem;
      background: #2563eb;
      color: #fff;
      font-size: .72rem;
      line-height: 1.4;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      transition: opacity .2s, visibility .2s, transform .2s;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, .1);
    }

    .toast.warning {
      border-left-color: var(--warning-color);
    }

    .toast.warning .toast-icon {
      color: var(--warning-color);
    }

    .toast.success {
      border-left-color: var(--success-color);
    }

    .toast.success .toast-icon {
      color: var(--success-color);
    }

    .toast.error {
      border-left-color: var(--error-color);
    }

    .toast.error .toast-icon {
      color: var(--error-color);
    }

    .toast.info {
      border-left-color: var(--primary-color);
    }

    .toast.info .toast-icon {
      color: var(--primary-color);
    }

    .toast-icon {
      flex-shrink: 0;
      margin-right: .2em;
      font-size: 1.4rem;
    }

    .toast-content {
      flex: 1;
      color: var(--text-primary);
      word-break: break-all;
    }

    .toast-container {
      display: flex;
      align-items: flex-start;
      flex-direction: column;
      position: fixed;
      z-index: 9999;
      top: 1.5rem;
      left: 1.5rem;
      /* 改为左对齐 */
      pointer-events: none;

      gap: .5rem;
    }

    .toast-close:hover {
      background: #f0f0f0;
      color: #222;
    }

    .toast-close {
      margin-left: .5em;
      padding: .2em .4em;
      border: none;
      background: none;
      color: #b0b0b0;
      font-size: 1.3rem;
      line-height: 1;
      cursor: pointer;
      transition: background .2s, color .2s;
      border-radius: 50%;
    }

    .toast {
      display: flex;
      align-items: center;
      min-width: 200px;
      max-width: 350px;
      padding: .35rem .8rem;
      border-left: 4px solid var(--primary-color);
      /* 更小圆角 */
      background: #fff;
      font-size: .88rem;
      /* 更小字体 */
      line-height: 1.4;
      pointer-events: auto;
      transition: box-shadow .2s, background .2s;
      animation: slideInLeft .35s cubic-bezier(.4, 1.4, .6, 1) both;
      /* ...其它样式... */
      animation: slideInLeft .35s cubic-bezier(.4, 1.4, .6, 1) both;
      /* 调低高度 */
      border-radius: 7px;
      box-shadow: 0 4px 16px rgba(59, 130, 246, .10), 0 1px 3px rgba(0, 0, 0, .06);

      gap: .5rem;
    }

    .template-tabs {
      display: flex;
      margin-bottom: 1rem;

      gap: 1rem;
    }

    .template-tab.active {
      background: var(--primary-color);
      color: white;
    }

    .template-tab {
      padding: .5rem 1rem;
      background: var(--bg-color);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 6px;
    }

    .template-modal-title {
      color: var(--text-primary);
      font-size: 1.25rem;
      font-weight: 600;
    }

    .template-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      border-bottom: 1px solid var(--border-color);
    }

    .template-modal-footer {
      display: flex;
      justify-content: flex-end;
      padding: 1rem 2rem;
      border-top: 1px solid var(--border-color);

      gap: 1rem;
    }

    .template-modal-content {
      overflow: hidden;
      display: flex;
      flex-direction: column;
      width: 90%;
      height: 90%;
      background: white;
      border-radius: 8px;
      box-shadow: var(--shadow-md);
    }

    .template-modal-body {
      overflow-y: auto;
      flex: 1;
      padding: 2rem;
    }

    .template-modal {
      display: none;
      align-items: center;
      justify-content: center;
      position: fixed;
      z-index: 1000;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, .5);
    }

    .template-editor:focus {
      border-color: var(--primary-color);
      outline: none;
    }

    .template-editor {
      width: 100%;
      height: calc(100% - 3rem);
      padding: .75rem;
      border: 1px solid var(--border-color);
      background: var(--bg-color);
      color: var(--text-secondary);
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: .875rem;
      line-height: 1.6;
      resize: none;
      border-radius: 6px;
    }

    .select-common:hover {
      border-color: var(--primary-color);
      background: #bbdefb;
    }

    .select-common option:focus {
      background: var(--nav-bg-1);
      color: var(--primary-color);
    }

    .select-common option:checked {
      background: var(--nav-bg-1);
      color: var(--primary-color);
      font-weight: 500;
    }

    .select-common option {
      padding: .5rem 1rem;
      border: none;
      background: #fff;
      color: var(--text-primary);
      font-size: .92em;
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 4px;
    }

    .select-common {
      min-width: 80px;
      padding: .5rem 1rem;
      border: 1px solid var(--border-color);
      background: var(--nav-bg-1);
      background-image: url('data:image/svg+xml,%3csvg xmlns=\'http://www.w3.org/2000/svg\' fill=\'none\' viewBox=\'0 0 20 20\'%3e%3cpath stroke=\'%236b7280\' stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'1.5\' d=\'M6 8l4 4 4-4\'/%3e%3c/svg%3e');
      background-repeat: no-repeat;
      background-position: right .5rem center;
      background-size: 1.5em 1.5em;
      color: var(--text-primary);
      font-size: .875rem;
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 6px;
      box-shadow: var(--dropdown-shadow);

      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }

    .section-title {
      padding: .5rem 0;
      color: var(--primary-color);
      font-size: 1rem;
      font-weight: 600;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .rules-list p {
      margin-bottom: 1rem;
    }

    .rules-list code {
      padding: .125rem .375rem;
      background: var(--bg-color);
      color: var(--primary-color);
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: .813rem;
      border-radius: 4px;
    }

    .rules-list {
      color: var(--text-secondary);
      font-size: .875rem;
      line-height: 1.6;
    }

    .result-container {
      display: flex;
      flex-direction: column;
      max-width: 1600px;
      margin: 0 auto;
    }

    .nav-sublink:hover {
      background: rgba(176, 114, 25, .08);
      color: #b07219;
      transform: translateY(-1px);
    }

    .nav-sublink {
      display: flex;
      align-items: center;
      height: 100%;
      padding: .25rem .75rem;
      background: transparent;
      color: #292929;
      font-size: .75rem;
      white-space: nowrap;
      text-decoration: none;
      transition: all var(--transition-fast);
      border-radius: 4px;
    }

    .nav-subgroup {
      display: flex;
      height: 100%;
      padding: .25rem;
      border-radius: 4px;

      gap: .5rem;
    }

    .nav-right {
      display: flex;
      align-items: center;
      margin-left: auto;
    }

    .nav-list {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .nav-link:hover {
      background: var(--nav-bg-1);
      transform: translateY(-1px);
    }

    .nav-link {
      padding: .5rem 1rem;
      background: var(--bg-color);
      color: var(--text-primary);
      font-size: .875rem;
      font-weight: 500;
      white-space: nowrap;
      text-decoration: none;
      transition: all var(--transition-fast);
      border-radius: 6px;
    }

    .nav-left {
      display: flex;
      align-items: center;

      gap: 1.5rem;
    }

    .nav-java-group:hover {
      background: #f0e9e4;
    }

    .nav-java-group {
      display: flex;
      align-items: center;
      height: 36px;
      padding: .25rem;
      background: #f8f4f0;
      transition: all var(--transition-fast);
      border-radius: 6px;

      gap: .5rem;
    }

    .nav-java-group .nav-link:hover {
      background: rgba(176, 114, 25, .1);
      transform: translateY(-1px);
    }

    .nav-java-group .nav-link {
      display: flex;
      align-items: center;
      height: 100%;
      margin: 0;
      padding: .25rem .75rem;
      background: transparent;
      color: #b07219;
    }

    .nav-group {
      display: flex;
      align-items: center;

      gap: .75rem;
    }


    .fields-table .move-btn {
      border: none !important;
      background: none !important;
      color: var(--primary-color) !important;
      box-shadow: 0 1px 2px rgba(0, 0, 0, .05) !important;
    }

    .fields-table .move-btn:hover {
      border: none !important;
      background: #f0f9ff !important;
      color: var(--primary-color) !important;
      box-shadow: 0 2px 8px rgba(37, 99, 235, .18) !important;
    }

    .fields-table .move-btn:hover svg {
      transform: scale(1.1);
    }

    .modal-header {
      margin-bottom: 1.5rem;
      color: var(--text-primary);
      font-size: 1.25rem;
      font-weight: 600;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;

      gap: 1rem;
    }

    .modal-content {
      width: 90%;
      max-width: 500px;
      padding: 2rem;
      background: white;
      animation: fadeIn var(--transition-fast);
      border-radius: 8px;
      box-shadow: var(--shadow-md);
    }

    .modal-body {
      margin-bottom: 1.5rem;
    }

    .modal input[type='text']:focus {
      border-color: var(--primary-color);
      outline: none;
    }

    .modal input[type='text'] {
      width: 100%;
      margin-bottom: 1rem;
      padding: .5rem;
      border: 1px solid var(--border-color);
      transition: border-color var(--transition-fast);
      border-radius: 4px;
    }

    .modal {
      display: none;
      align-items: center;
      justify-content: center;
      position: fixed;
      z-index: 2000;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, .5);
      animation: fadeIn var(--transition-fast);
    }

    .modal .btn-load:hover {
      background: var(--primary-hover);
    }

    .modal .btn-load {
      background: var(--primary-color);
    }

    .hljs-strong {
      color: #2a9d8f;
      font-weight: normal;
    }

    .hljs-selector-class {
      color: #2a9d8f;
    }

    .hljs-emphasis {
      font-style: normal;
    }

    .hljs-deletion {
      color: #93a1a1;
    }

    .hljs {
      padding: 0 !important;
      background: white !important;
      color: #2a9d8f !important;
    }

    .generate-btn.error {
      animation: shake .5s;
    }

    .generate-btn.error .error-tooltip {
      visibility: visible;
      opacity: 1;
    }

    .generate-btn:hover {
      background: var(--primary-hover);
    }

    .generate-btn {
      position: relative;
      background: var(--primary-color);
      color: #fff;
      font-weight: 600;
    }

    .floating-nav {
      position: sticky;
      z-index: 100;
      top: 0;
      margin-bottom: 2rem;
      padding: .75rem 2rem;
      background: white;
      border-radius: 8px;
      box-shadow: var(--shadow-md);
    }

    .files-grid {
      display: grid;

      grid-template-columns: repeat(2, 1fr);
      gap: 2rem;
    }

    .file-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      z-index: 50;
      padding: .75rem 1rem;
      border-bottom: 1px solid var(--border-color);
      background: var(--bg-color);
    }

    .file-header .tooltip-container .tooltip {
      z-index: 51;
    }

    .file-header .copy-btn:hover svg {
      stroke: var(--primary-hover) !important;
    }

    .file-header .copy-btn:hover {
      border: none !important;
      background: #f0f9ff !important;
      color: var(--primary-hover) !important;
    }

    .file-header .copy-btn svg {
      stroke: var(--primary-color) !important;
    }

    .file-header .copy-btn {
      border: none !important;
      background: none !important;
      color: var(--primary-color) !important;
      box-shadow: none !important;
    }

    .file-block {
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 100%;
      border: 1px solid var(--border-color);
      background: white;
      border-radius: 8px;
    }

    .fields-table tr.row-move-animate {
      position: relative;
      z-index: 1;
      animation: rowMove .38s cubic-bezier(.4, 1.4, .6, 1);
    }

    .fields-table th {
      position: sticky;
      z-index: 2;
      top: 0;
      height: 32px;
      background: #f1f5f9;
      font-weight: 500;
    }

    .fields-table td.row-move-animate {
      position: relative;
      z-index: 1;
      animation: rowMove .38s cubic-bezier(.4, 1.4, .6, 1);
    }

    .fields-table td {
      padding: .25rem .5rem;
      border: 1px solid #e2e8f0;
      background: #fff;
      font-size: .875rem;
      text-align: left;
    }

    .fields-table select[disabled] {
      background-color: #f1f5f9 !important;
      opacity: .75;
      cursor: not-allowed;
    }

    .fields-table select:hover {
      border-color: var(--primary-hover);
      background: #fff !important;
    }

    .fields-table select:focus {
      border-color: var(--primary-color);
      background: #fff !important;
      outline: none;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, .1);
    }

    .fields-table select {
      width: 100%;
      height: 32px;
      padding: .375rem .75rem;
      border: 1px solid #e2e8f0;
      background: #fff;
      color: var(--text-primary);
      font-size: .875rem;
      line-height: 1.25;
      transition: all .2s;
      border-radius: 6px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
    }

    .fields-table input[type='checkbox']:hover {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(37, 99, 235, .12);
    }

    .fields-table input[type='checkbox']:checked::after {
      content: '';
      display: block;
      position: absolute;
      top: calc(50% - 2px);
      left: 50%;
      width: 7px;
      height: 10px;
      border: solid #fff;
      border-width: 0 2px 2px 0;
      transform: translate(-50%, -50%) rotate(45deg);
      border-radius: 1px;
    }

    .fields-table input[type='checkbox']:checked {
      border-color: var(--primary-color);
      background: var(--primary-color);
      box-shadow: 0 2px 8px rgba(37, 99, 235, .18);
    }

    .fields-table input[type='checkbox'] {
      position: relative;
      width: 18px;
      height: 18px;
      padding: 2.5px;
      border: 2px solid var(--border-color);
      background: #fff;
      outline: none;
      cursor: pointer;
      transition: border-color .2s, box-shadow .2s, background .2s, transform .18s cubic-bezier(.4, 1.4, .6, 1);
      border-radius: 5px;
      box-shadow: 0 1px 3px rgba(59, 130, 246, .08);

      appearance: none;
    }

    .fields-table {
      width: 100%;
      min-width: 700px;
      background: #fff;
      table-layout: fixed;
    }

    .field-type-param {
      min-width: 0;
    }

    .field-name-input {
      width: 100% !important;
      background: #fff !important;
      color: var(--text-primary) !important;
      font-weight: 500;
    }

    .field-comment-input:hover {
      border-color: var(--primary-hover) !important;
      background: #fff !important;
    }

    .field-comment-input:focus {
      border-color: var(--primary-color) !important;
      background: #fff !important;
      outline: none !important;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, .1) !important;
    }

    .field-comment-input {
      width: 100% !important;
      height: 32px !important;
      padding: .375rem .75rem !important;
      border: 1px solid #e2e8f0 !important;
      background: #fff !important;
      color: var(--text-primary) !important;
      font-size: .875rem !important;
      font-weight: 500 !important;
      font-style: normal;
      transition: all .2s !important;
      border-radius: 6px !important;
      box-shadow: 0 1px 2px rgba(0, 0, 0, .05) !important;
    }

    .field-actions button:hover {
      border-color: var(--primary-color);
      background: #f0f9ff;
      box-shadow: 0 2px 8px rgba(37, 99, 235, .18);
    }

    .field-actions button:active svg {
      transform: scale(1.18);

      filter: brightness(1.2) drop-shadow(0 0 4px var(--primary-color));
    }

    .field-actions button:active {
      animation: btnBounce .22s cubic-bezier(.4, 1.4, .6, 1);
    }

    .field-actions button svg {
      transition: transform .18s, filter .18s;
    }

    .field-actions button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      padding: .25rem;
      border: none;
      background: transparent;
      font-size: .875rem;
      cursor: pointer;
      transition: box-shadow .18s, background .18s, border-color .18s, transform .18s cubic-bezier(.4, 1.4, .6, 1);
      border-radius: 4px;

      will-change: transform;
    }

    .field-actions {
      display: flex;
      justify-content: center;

      gap: .25rem;
    }

    .field-actions .delete-btn:hover {
      border-color: var(--error-color);
      background: #fef2f2;
      box-shadow: 0 2px 4px rgba(0, 0, 0, .1);
    }

    .field-actions .delete-btn {
      color: var(--error-color);
      box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
    }

    .field-actions .btn-common.icon-only.delete-btn:hover {
      border: none !important;
      background: #fef2f2 !important;
    }

    .field-actions .btn-common.icon-only.delete-btn {
      border: none !important;
      background: #fff !important;
    }

    .error-tooltip:before {
      content: '';
      position: absolute;
      top: -6px;
      left: 50%;
      margin-top: -12px;
      border: 6px solid transparent;
      border-bottom: 6px solid var(--error-color);
      transform: translateX(-50%);
    }

    .error-tooltip {
      visibility: hidden;
      position: absolute;
      z-index: 1000;
      top: calc(100% + 10px);
      left: 50%;
      padding: .5rem 1rem;
      background: var(--error-color);
      color: white;
      font-size: .75rem;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      transition: all var(--transition-fast);
      transform: translateX(-50%);
      border-radius: 4px;
      box-shadow: var(--shadow-sm);
    }

    .entity-title {
      color: var(--primary-color);
      font-size: 1.25rem;
      font-weight: 600;
    }

    .entity-table-header select:hover {
      border-color: var(--primary-hover);
      background: #fff;
      background-image: url('data:image/svg+xml,%3csvg xmlns=\'http://www.w3.org/2000/svg\' fill=\'none\' viewBox=\'0 0 20 20\'%3e%3cpath stroke=\'%236b7280\' stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'1.5\' d=\'M6 8l4 4 4-4\'/%3e%3c/svg%3e') !important;
    }

    .entity-table-header select:focus {
      border-color: var(--primary-color);
      background: #fff;
      outline: none;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, .1);
    }

    .entity-table-header select {
      height: 32px;
      padding: .375rem .75rem;
      padding-right: 2rem !important;
      border: 1px solid #e2e8f0;
      background: #fff;
      background-image: url('data:image/svg+xml,%3csvg xmlns=\'http://www.w3.org/2000/svg\' fill=\'none\' viewBox=\'0 0 20 20\'%3e%3cpath stroke=\'%236b7280\' stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'1.5\' d=\'M6 8l4 4 4-4\'/%3e%3c/svg%3e') !important;
      background-repeat: no-repeat !important;
      background-position: right .5rem center !important;
      background-size: 1.5em 1.5em !important;
      color: var(--text-primary);
      font-size: .875rem;
      transition: all .2s;
      border-radius: 6px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, .05);

      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }

    .entity-table-header {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      justify-content: space-between;
      padding-bottom: .5rem;
      border-bottom: 1px solid #e2e8f0;
      border-radius: 8px 8px 0 0;

      gap: .5rem;
    }

    .entity-table-header .entity-package-input {
      width: 300px;
      color: var(--text-primary);
    }

    .entity-table-header .entity-name-input {
      width: 200px;
      color: var(--text-primary);
      font-weight: 500;
    }

    .entity-table-header .entity-dbtype-select {
      width: 120px;
      color: var(--text-primary);
      font-weight: 500;
      cursor: pointer;
    }

    .entity-table-fields {
      overflow-x: unset !important;
      max-width: 100%;
      padding-bottom: .25rem;
      background: #fcfcfc;
    }

    .entity-table-card {
      width: 100%;
      max-width: 1600px;
      margin-right: auto;
      margin-bottom: 1.5rem;
      margin-left: auto;
      padding: 2rem;
      border: 1px solid #e2e8f0;
      background: #fff;
      animation: fadeIn .3s;
      border-radius: 8px;
      box-shadow: var(--shadow-md);
    }

    .entity-selector:hover .entity-select-options {
      visibility: visible;
      opacity: 1;
      transform: translateY(0);
    }

    .entity-selector {
      position: relative;
      min-width: 180px;
    }

    .entity-select-options {
      overflow-y: auto;
      visibility: hidden;
      position: absolute;
      z-index: 101;
      top: calc(100% + 4px);
      left: 0;
      width: 100%;
      max-height: 240px;
      background: white;
      opacity: 0;
      transition: all var(--transition-fast);
      transform: translateY(-10px);
      border-radius: 6px;
      box-shadow: var(--shadow-md);
    }

    .entity-select-header:hover {
      background: #bbdefb;
      transform: translateY(-1px);
    }

    .entity-select-header::after {
      content: '▼';
      font-size: .75rem;
      transition: transform var(--transition-fast);
    }

    .entity-select-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: .5rem 1rem;
      background: var(--nav-bg-1);
      color: var(--text-primary);
      font-size: .875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 6px;
    }

    .entity-option.selected {
      background: var(--nav-bg-1);
      font-weight: 500;
    }

    .entity-option:hover {
      background: var(--nav-bg-1);
    }

    .entity-option {
      padding: .5rem 1rem;
      color: var(--text-primary);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .entity-header {
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .entity-dbtype-select:focus {
      border-color: var(--primary-color);
      background: #e8f0fe;
      color: var(--primary-color);
    }

    .entity-dbtype-select option:focus {
      background: #e8f0fe;
      color: var(--primary-color);
    }

    .entity-dbtype-select option:checked {
      background: #e8f0fe;
      color: var(--primary-color);
      font-weight: 500;
    }

    .entity-dbtype-select option {
      padding: .5rem 1rem;
      border: none;
      background: #fff;
      color: var(--text-primary);
      font-size: .95em;
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 4px;
    }

    .entity-dbtype-select {
      min-width: 80px;
      padding: .45rem 2.2rem .45rem 1rem;
      border: 1.5px solid var(--border-color);
      background: #f8fafc;
      background-image: url('data:image/svg+xml,%3csvg xmlns=\'http://www.w3.org/2000/svg\' fill=\'none\' viewBox=\'0 0 20 20\'%3e%3cpath stroke=\'%232563eb\' stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'2\' d=\'M6 8l4 4 4-4\'/%3e%3c/svg%3e');
      background-repeat: no-repeat;
      background-position: right .8rem center;
      background-size: 1.3em 1.3em;
      color: var(--text-primary);
      font-size: .95rem;
      outline: none;
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, .04);

      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }

    .entity-cards {
      display: flex;
      flex-direction: column;
      margin-bottom: 3rem;

      gap: 3rem;
    }

    .entity-card {
      padding: 2rem;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: var(--shadow-md);
    }

    .entity-actions {
      display: flex;
      margin-left: 1rem;

      gap: .5rem;
    }

    .entity-actions .btn-common.icon-only.delete-btn:hover {
      border-color: #dc2626 !important;
      background: #fef2f2 !important;
    }

    .entity-actions .btn-common.icon-only.delete-btn {
      border: 1.5px solid var(--error-color) !important;
      background: #fff !important;
    }

    .delete-icon.confirm:hover {
      background: rgba(220, 38, 38, .15);
    }

    .delete-icon.confirm::before {
      opacity: 0;
      transform: translateY(-100%);
    }

    .delete-icon.confirm::after {
      opacity: 1;
      transform: translateY(0);
    }

    .delete-icon.confirm {
      background: rgba(220, 38, 38, .1);
    }

    .delete-icon:hover {
      background: rgba(0, 0, 0, .05);
    }

    .delete-icon::before {
      content: '×';
      transform: translateY(0);
    }

    .delete-icon::after {
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      width: 100%;
      height: 100%;
      transition: all .3s ease;
    }

    .delete-icon::after {
      content: '?';
      color: var(--error-color);
      opacity: 0;
      transform: translateY(100%);
    }

    .delete-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      width: 20px;
      height: 20px;
      background: transparent;
      color: var(--text-secondary);
      font-size: 16px;
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 4px;
    }

    .delete-btn:hover svg {
      transform: scale(1.1);

      stroke: #dc2626;
    }

    .delete-btn:hover {
      border-color: var(--primary-color);
      background: #f0f9ff;
      color: var(--primary-color);
      box-shadow: 0 2px 4px rgba(0, 0, 0, .1);
    }

    .delete-btn:hover {
      border-color: var(--error-color);
      background: #fef2f2;
      color: #dc2626;
    }

    .delete-btn:hover {
      border-color: var(--error-color);
      background: #fef2f2;
    }

    .delete-btn svg {
      width: 16px;
      height: 16px;
      transition: all .2s;

      stroke-width: 2;
      stroke: var(--error-color);
    }

    .delete-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      padding: .25rem;
      border: 1px solid #e2e8f0;
      border-color: #e2e8f0;
      background: #fff;
      color: var(--text-secondary);
      font-size: 1rem;
      cursor: pointer;
      transition: all .2s;
      border-radius: 6px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
    }

    .copy-btn:hover svg {
      transform: scale(1.1);

      stroke: var(--primary-hover) !important;
    }

    .copy-btn:hover {
      border: none !important;
      border-color: var(--primary-color);
      background: #f0f9ff !important;
      color: var(--primary-hover) !important;
    }

    .copy-btn svg {
      width: 18px;
      height: 18px;
      transition: transform .2s;

      stroke-width: 2;
      stroke: var(--primary-color) !important;
    }

    .copy-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 50;
      width: 36px;
      height: 36px;
      padding: 0;
      border: none !important;
      background: #fff !important;
      color: var(--primary-color) !important;
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 8px;
      box-shadow: none !important;
    }

    .container {
      max-width: 100%;
      margin: 1rem auto;
      padding: 0 2rem;
    }

    .confirm-modal-header {
      margin-bottom: 1rem;
      color: var(--text-primary);
      font-size: 1.25rem;
      font-weight: 600;
    }

    .confirm-modal-footer {
      display: flex;
      justify-content: flex-end;

      gap: 1rem;
    }

    .confirm-modal-content {
      width: 90%;
      max-width: 400px;
      padding: 2rem;
      background: white;
      animation: fadeIn var(--transition-fast);
      border-radius: 8px;
      box-shadow: var(--shadow-md);
    }

    .confirm-modal-body {
      margin-bottom: 1.5rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .confirm-modal {
      display: none;
      align-items: center;
      justify-content: center;
      position: fixed;
      z-index: 3000;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, .5);
    }

    .config-selector {
      overflow: visible !important;
      display: inline-block;
      position: relative;
      width: 100%;
      min-width: 0;
      background: none;
      vertical-align: middle;
    }

    .config-select-options.show {
      visibility: visible;
      opacity: 1;
      transform: translateY(0);
    }

    .config-select-options::-webkit-scrollbar-track {
      background: transparent;
    }

    .config-select-options::-webkit-scrollbar-thumb {
      background-color: var(--primary-color);
      border-radius: 3px;
    }

    .config-select-options::-webkit-scrollbar {
      display: none;
      width: 6px;
    }

    .config-select-options {
      overflow-y: auto;
      visibility: hidden;
      position: absolute;
      z-index: 9999 !important;
      top: calc(100% + 4px);
      left: 0;
      width: 100%;
      max-height: 240px;
      padding: 4px;
      background: #fff;
      opacity: 0;
      transition: all var(--transition-fast);
      transform: translateY(-10px);
      border-radius: 6px;
      box-shadow: var(--shadow-md);

      scrollbar-width: none;
      scrollbar-color: var(--primary-color) transparent;
    }

    .config-select-header:hover {
      border-color: var(--primary-color);
      background: #f0f9ff;
      transform: translateY(-1px);
    }

    .config-select-header::after {
      content: '▼';
      font-size: .75rem;
      transition: transform var(--transition-fast);
    }

    .config-select-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 32px;
      min-height: 32px;
      padding: 0 1rem;
      border: 1px solid var(--border-color);
      background: #fff;
      color: var(--text-primary);
      font-size: .875rem;
      line-height: 1;
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 6px;
      box-sizing: border-box;

      gap: .5rem;
    }

    .config-section {
      display: grid;
      align-items: start;
      max-width: 1600px;
      margin: 0 auto 2rem auto;
      padding: 2rem;
      background: var(--card-bg);
      animation: fadeIn var(--transition-normal) ease-out;
      border-radius: 8px;
      box-shadow: var(--shadow-md);

      grid-template-columns: 1fr 1fr;
      gap: 3rem;
    }

    .config-option.selected {
      background: #f0f9ff;
      color: var(--primary-color);
      font-weight: 500;
    }

    .config-option:hover {
      background: #f0f9ff;
      color: var(--primary-color);
    }

    .config-option:hover .tooltip-container {
      opacity: 1;
    }

    .config-option {
      display: flex;
      align-items: center;
      min-width: 0;
      padding: .5rem;
      color: var(--text-primary);
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 4px;

      gap: .5rem;
      /* 确保flex子元素可以正确收缩 */
    }

    .config-option .tooltip-container {
      margin-left: auto;
      opacity: 0;
      transition: opacity var(--transition-fast);
    }

    .config-option .tooltip-container .tooltip {
      display: none !important;
    }

    .config-option .option-text {
      overflow: hidden;
      flex: 1;
      min-width: 0;
      /* 确保文本可以正确收缩 */
      padding: 0 .5rem;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    .config-option .delete-icon.confirm:hover {
      background: rgba(220, 38, 38, .15);
    }

    .config-option .delete-icon.confirm::before {
      opacity: 0;
      transform: translate(-50%, -150%);
    }

    .config-option .delete-icon.confirm::after {
      pointer-events: auto;
      opacity: 1;
      transform: translate(-50%, -50%);
    }

    .config-option .delete-icon.confirm {
      background: rgba(220, 38, 38, .1);
    }

    .config-option .delete-icon::before {
      content: '×';
      position: absolute;
      top: 50%;
      left: 50%;
      width: auto;
      height: auto;
      font-size: 14px;
      opacity: 1;
      transition: all .3s ease;
      transform: translate(-50%, -50%);
    }

    .config-option .delete-icon::after {
      content: '?';
      position: absolute;
      top: 50%;
      left: 50%;
      width: auto;
      height: auto;
      background: none;
      color: var(--error-color);
      font-size: 14px;
      pointer-events: none;
      opacity: 0;
      transition: all .3s ease;
      transform: translate(-50%, 100%);
    }

    .config-option .delete-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      width: 18px;
      height: 18px;
      margin-right: 8px;
      margin-left: 0;
      background: transparent;
      color: var(--text-secondary);
      font-size: 14px;
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 3px;
    }

    .code-title:hover {
      background: rgba(0, 0, 0, .05);
    }

    .code-title {
      padding: 4px 8px;
      color: var(--text-primary);
      font-size: .875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 4px;
    }

    .button-groups {
      display: flex;
      align-items: center;

      gap: 2rem;
    }

    .button-group.template-group {
      border: 1px solid #f5d0fe;
      background: #fdf4ff;
    }

    .button-group.main-group {
      border: 1px solid #bbf7d0;
      background: #f0fdf4;
    }

    .button-group.config-group {
      border: 1px solid #bae6fd;
      background: #f0f9ff;
    }

    .button-group {
      display: flex;
      align-items: center;
      padding: .5rem 0;
      border: none;
      background: none;
      border-radius: 0;
      box-shadow: none;

      gap: .5rem;
    }

    .btn-white:hover {
      border-color: var(--primary-hover) !important;
      background: var(--primary-color) !important;
      color: #fff !important;
    }

    .btn-white {
      border: 1.5px solid var(--primary-color) !important;
      background: #fff !important;
      color: var(--primary-color) !important;
      transition: all .2s !important;
    }

    .btn-table:hover {
      border-color: var(--primary-hover) !important;
      background: var(--primary-color) !important;
      color: #fff !important;
    }

    .btn-table {
      background: #fff !important;
      color: var(--primary-color) !important;
      transition: all .2s !important;
    }

    .btn-template:hover {
      background: var(--new-hover);
    }

    .btn-template {
      background: var(--new-color);
    }

    .btn-secondary:hover {
      border-color: #cbd5e1;
      background: var(--new-hover);
    }

    .btn-secondary {
      border: 1px solid #e2e8f0;
      background: var(--new-color);
      color: #fff;
    }

    .btn-save:hover {
      background: var(--success-hover);
    }

    .btn-save {
      background: var(--success-color);
      color: #fff;
    }

    .btn-primary:hover {
      background: var(--primary-hover);
    }

    .btn-primary {
      background: var(--primary-color);
      color: #fff;
    }

    .btn-new:hover {
      background: var(--new-hover);
    }

    .btn-new {
      background: var(--new-color);
      color: #fff;
    }

    .btn-info:hover {
      background: var(--info-hover);
    }

    .btn-info {
      background: var(--info-color);
      color: #fff;
    }

    .btn-example:hover {
      background: var(--warning-hover);
    }

    .btn-example {
      background: var(--warning-color);
      color: #fff;
    }

    .btn-danger:hover {
      border-color: #b91c1c;
      background: #b91c1c;
      color: #fff;
    }

    .btn-danger {
      display: inline-block;
      width: auto;
      min-width: 0;
      height: 36px;
      padding: .5rem 1rem;
      border: 1.5px solid #dc2626;
      background: var(--error-color);
      color: #fff;
      font-size: .875rem;
      font-weight: 500;
      line-height: 1;
      vertical-align: middle;
      transition: all .2s;
      border-radius: 6px;
      box-sizing: border-box;
    }

    .btn-config:hover {
      background: var(--info-hover);
    }

    .btn-config {
      background: var(--info-color);
    }

    .btn-common.icon-only.move-btn:hover {
      border-color: var(--primary-color) !important;
      background: #f0f9ff !important;
      color: var(--primary-color) !important;
    }

    .btn-common.icon-only.delete-btn:hover svg:only-child {
      stroke: #b91c1c !important;
    }

    .btn-common.icon-only.delete-btn:hover {
      border: none !important;
      border-color: #dc2626 !important;
      background: #fef2f2 !important;
    }

    .btn-common.icon-only.delete-btn svg:only-child {
      stroke: var(--error-color) !important;
    }

    .btn-common.icon-only.delete-btn {
      border: 1.5px solid var(--error-color) !important;
      background: #fff !important;
    }

    .btn-common.icon-only.copy-btn:hover {
      border-color: var(--primary-color) !important;
      background: #f0f9ff !important;
    }

    .btn-common.icon-only svg:only-child {
      display: block;
      width: 20px;
      height: 20px;
      margin: auto !important;
    }

    .btn-common.icon-only {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      min-width: 32px;
      height: 32px;
      min-height: 32px;
      padding: 0 !important;
    }

    .btn-common svg {
      margin-right: .25em;
    }

    .btn-common {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 36px;
      margin: 0 .25rem;
      padding: .5rem 1rem;
      border: none;
      font-size: .875rem;
      font-weight: 500;
      line-height: 1;
      cursor: pointer;
      transition: all .2s;
      border-radius: 6px;
    }

    .back-to-top:hover svg {
      transform: translateY(-1px);
    }

    .back-to-top:hover {
      background: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, .35);
    }

    .back-to-top-fixed {
      display: flex;
      align-items: center;
      flex-direction: column;
      position: fixed;
      z-index: 9999;
      right: 32px;
      bottom: 32px;
      transition: opacity .3s;
    }

    .back-to-top-fixed .tooltip {
      bottom: 120%;
      left: 50%;
      margin-bottom: 8px;
      transform: translateX(-50%);
    }

    .back-to-top-fixed .back-to-top svg {
      width: 28px;
      height: 28px;
    }

    .back-to-top-fixed .back-to-top {
      width: 48px;
      height: 48px;
      font-size: 1.5rem;
      border-radius: 12px;
    }

    .back-to-top svg {
      width: 18px;
      height: 18px;
      transition: transform .2s;

      stroke-width: 2.5;
    }

    .back-to-top {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: var(--primary-color);
      color: white;
      cursor: pointer;
      transition: all var(--transition-fast);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(59, 130, 246, .25);
    }

    .btn-table-bottom {
      width: 100% !important;
      min-width: none !important;
    }

    .add-field-row {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      margin-top: 3px;
      padding-bottom: 2px;
    }

    .add-field-btn:hover {
      border-color: var(--primary-color) !important;
      background: #f0f9ff !important;
      color: var(--primary-color) !important;
      transform: translateY(-1px) !important;
    }

    .add-field-btn {
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      width: 100% !important;
      min-width: 0 !important;
      height: 36px !important;
      border: 1px dashed #e2e8f0 !important;
      background: #fff !important;
      color: var(--text-secondary) !important;
      font-size: 1.25rem !important;
      cursor: pointer !important;
      transition: all .2s !important;
      border-radius: 6px !important;
      box-sizing: border-box;
    }

    .add-entity-block-btn+.tooltip.tooltip-top {
      margin-bottom: -10px !important;
      font-size: .8rem !important;
      transform: translateX(-50%) translateY(0) !important;
    }

    .add-entity-block-btn:hover svg {
      stroke: var(--primary-hover);
    }

    .add-entity-block-btn:hover {
      border-color: var(--primary-hover);
      background: #f0f9ff;
      transform: translateY(-1px) scale(1.0001);
      box-shadow: 0 4px 16px rgba(59, 130, 246, .15);
    }

    .add-entity-block-btn svg {
      width: 32px;
      height: 32px;
      transition: stroke .2s;

      stroke: var(--primary-color);
      stroke-width: 2.5;
    }

    .add-entity-block-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 99%;
      height: 54px;
      margin: .1rem auto 1.5rem auto;
      padding: 0 2rem;
      border: 2px dashed var(--primary-color);
      background: #fff;
      cursor: pointer;
      transition: all .2s;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(59, 130, 246, .08);
    }

    .action-btn.copy-btn {
      border: 1.5px solid var(--primary-color) !important;
      background: #fff !important;
      color: var(--primary-color) !important;
      box-shadow: none !important;
    }

    .action-btn:hover svg {
      transform: scale(1.1);

      stroke: var(--primary-hover);
    }

    .action-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, .1);
    }

    .action-btn svg {
      width: 16px;
      height: 16px;
      transition: all .2s;

      stroke-width: 2;
    }

    .action-btn svg {
      stroke: var(--primary-color);
    }

    .action-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      padding: .25rem;
      border: 1px solid #e2e8f0;
      background: #fff;
      font-size: 1rem;
      cursor: pointer;
      transition: all .2s;
      border-radius: 6px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
    }

    .action-btn-green-outline {
      border: 1.5px solid #22c55e !important;
      background: #fff !important;
      color: #22c55e !important;
      transition: all .2s !important;
    }

    .action-btn-green-outline:hover {
      border-color: transparent !important;
      background: #e6faef !important;
      color: #22c55e !important;
    }

    .action-btn-blue-outline {
      border: 1.5px solid #2563eb !important;
      background: #fff !important;
      color: #2563eb !important;
      transition: all .2s !important;
    }

    .action-btn-blue-outline:hover {
      border-color: transparent !important;
      background: #f0f7ff !important;
      color: #2563eb !important;
    }

    .action-btn-green-outline svg {
      stroke: #22c55e !important;
    }

    .action-btn.copy-btn.action-btn-blue-outline.icon-only:hover {
      border-width: 0 !important;
      border-color: transparent !important;
      box-shadow: none !important;
    }

    :root {
      --border-color: #e2e8f0;

      --primary-color: #2563eb;
      /* 生成按钮 - 深蓝色 */
      --primary-hover: #1d4ed8;
      --success-color: #22c55e;
      /* 保存按钮 - 绿色 */
      --success-hover: #16a34a;
      --info-color: #3b82f6;
      /* 说明按钮 - 蓝色 */
      --info-hover: #2563eb;
      --template-color: #7c3aed;
      /* 模板按钮 - 紫色 */
      --template-hover: #5b21b6;
      --warning-color: #f59e0b;
      --warning-hover: #d97706;
      --new-color: #64748b;
      --new-hover: #475569;
      --error-color: #dc2626;
      --bg-color: #f8fafc;
      --card-bg: #fff;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, .1);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, .1);
      --nav-level-1: #1e40af;
      --nav-level-2: #3b82f6;
      --nav-level-3: #60a5fa;
      --nav-bg-1: #e3f2fd;
      --nav-bg-2: #e8f5e9;
      --nav-bg-3: #f3e5f5;
      --nav-bg-4: #fff3e0;
      --transition-fast: .2s;
      --transition-normal: .3s;
      --dropdown-bg: #fff;
      --dropdown-border: #f1f1f1;
      --dropdown-hover-bg: #e3f2fd;
      --dropdown-hover-border: var(--primary-color);
      --dropdown-radius: 6px;
      --dropdown-shadow: 0 4px 6px -1px rgba(0, 0, 0, .1);
      --dropdown-arrow: #f1f1f1;
      --dropdown-arrow-hover: var(--primary-color);
      --button-hover-lift: -1px;
    }

    /* 新增样式 */
    .input-error {
      border-color: #dc2626 !important;
      box-shadow: 0 0 0 2px rgba(220, 38, 38, .15) !important;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="config-section"
      style="display:block;max-width:none;width:100%;box-shadow:none;padding:0;background:transparent;">
      <div class="input-section" style="width:100%;max-width:1800px;margin:0 auto;">
        <div class="section-header">
          <div class="config-selector" id="mainConfigSelector" style="min-width:100px;"></div>
          <div class="button-groups">
            <!-- 顶部按钮区 -->
          </div>
        </div>
        <div id="configTableContainer" style="margin-top:1.5rem;"></div>
        <textarea id="jsonInput" style="display:none;"></textarea>
      </div>
      <div class="rules-section" style="display:none;">
        <div class="section-header">
          <div class="section-title">使用说明</div>
        </div>
        <div class="rules-list" id="rulesListContent">
          <!-- 快捷键说明 -->
          <div
            style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
            <h4 style="margin: 0 0 10px 0; color: #007bff;">快捷键说明</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 14px;">
              <div><strong>Ctrl + S</strong>：保存配置</div>
              <div><strong>Ctrl + Enter</strong>：生成代码</div>
              <div><strong>Ctrl + I</strong>：导入配置</div>
              <div><strong>Ctrl + E</strong>：导出配置</div>
              <div><strong>Ctrl + T</strong>：打开模板编辑</div>
              <div><strong>Ctrl + H</strong>：打开说明</div>
              <div><strong>Ctrl + D</strong>：删除配置</div>
            </div>
          </div>

          <!-- 功能概述 -->
          <div
            style="margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
            <h4 style="margin: 0 0 10px 0; color: #0ea5e9;">功能概述</h4>
            <p style="margin: 0; line-height: 1.6;">
              代码生成器是一个基于Web的Java代码生成工具，支持快速生成Spring Boot项目的完整代码结构，
              包括实体类、VO类、Service接口、Service实现类、Mapper接口、Controller控制器、SQL建表语句等。
              支持MySQL和Oracle数据库，提供可视化的配置界面和模板编辑功能。
            </p>
          </div>

          <!-- 主要功能 -->
          <div
            style="margin-bottom: 20px; padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
            <h4 style="margin: 0 0 10px 0; color: #f59e0b;">主要功能</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
              <div><strong>📝 配置管理</strong>：支持保存、加载、删除配置</div>
              <div><strong>📤 导入导出</strong>：JSON格式配置导入导出</div>
              <div><strong>🎨 模板编辑</strong>：自定义代码生成模板</div>
              <div><strong>⚡ 代码生成</strong>：一键生成完整项目代码</div>
              <div><strong>📋 示例生成</strong>：快速生成示例配置</div>
              <div><strong>🔧 数据库支持</strong>：MySQL和Oracle双数据库</div>
            </div>
          </div>

          <!-- 生成的文件类型 -->
          <div
            style="margin-bottom: 20px; padding: 15px; background: #ecfdf5; border-radius: 8px; border-left: 4px solid #10b981;">
            <h4 style="margin: 0 0 10px 0; color: #10b981;">生成的文件类型</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 14px;">
              <div><strong>🏗️ 实体类</strong>：Domain实体类（带注解）</div>
              <div><strong>📋 VO类</strong>：展示对象类（带校验）</div>
              <div><strong>🔧 Service接口</strong>：业务接口定义</div>
              <div><strong>⚙️ Service实现</strong>：业务逻辑实现类</div>
              <div><strong>🗄️ Mapper接口</strong>：数据访问层接口</div>
              <div><strong>🌐 Controller</strong>：REST API控制器</div>
              <div><strong>📊 SQL语句</strong>：建表SQL脚本</div>
              <div><strong>📄 JSON配置</strong>：配置示例文件</div>
            </div>
          </div>

          <!-- 配置格式说明 -->
          <div
            style="margin-bottom: 20px; padding: 15px; background: #fef2f2; border-radius: 8px; border-left: 4px solid #ef4444;">
            <h4 style="margin: 0 0 10px 0; color: #ef4444;">配置格式说明</h4>
            <p style="margin: 0 0 10px 0;"><strong>1. 实体配置格式：</strong></p>
            <code style="display: block; background: #f8f9fa; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
              "包名.类名": {<br>
              &nbsp;&nbsp;"databases": "mysql",<br>
              &nbsp;&nbsp;"字段名": "类型(参数) | *注释"<br>
              }
            </code>
            <p style="margin: 0 0 10px 0;"><strong>2. 字段格式说明：</strong></p>
            <ul style="margin: 0; padding-left: 20px;">
              <li><code>字段名</code>：Java驼峰命名，自动转换为数据库下划线命名</li>
              <li><code>类型(参数)</code>：Java数据类型，括号内为参数（可选）</li>
              <li><code>*注释</code>：字段注释，*号表示必填字段</li>
            </ul>
          </div>

          <!-- 支持的字段类型 -->
          <div
            style="margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
            <h4 style="margin: 0 0 10px 0; color: #0ea5e9;">支持的字段类型</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 14px;">
              <div><code>String(length)</code>：字符串，默认255</div>
              <div><code>Long(length)</code>：长整型，默认20</div>
              <div><code>Integer</code>：整型</div>
              <div><code>BigDecimal(precision,scale)</code>：高精度数值</div>
              <div><code>LocalDateTime(pattern)</code>：日期时间</div>
              <div><code>Boolean</code>：布尔值</div>
            </div>
            <p style="margin: 10px 0 0 0; font-size: 13px; color: #666;">
              <strong>示例：</strong><code>String(100)</code>、<code>BigDecimal(10,2)</code>、<code>LocalDateTime(yyyy-MM-dd HH:mm:ss)</code>
            </p>
          </div>

          <!-- 自动处理功能 -->
          <div
            style="margin-bottom: 20px; padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
            <h4 style="margin: 0 0 10px 0; color: #f59e0b;">自动处理功能</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 14px;">
              <div><strong>🆔 通用字段</strong>：自动添加id、createTime、updateTime等</div>
              <div><strong>🔄 命名转换</strong>：驼峰转下划线命名</div>
              <div><strong>📝 注解添加</strong>：Swagger、校验、JSON格式化</div>
              <div><strong>🔍 字段校验</strong>：必填、邮箱、手机号等校验</div>
              <div><strong>🗄️ 数据库映射</strong>：自动生成数据库字段类型</div>
              <div><strong>📊 查询条件</strong>：自动生成查询条件方法</div>
            </div>
          </div>

          <!-- 使用流程 -->
          <div
            style="margin-bottom: 20px; padding: 15px; background: #ecfdf5; border-radius: 8px; border-left: 4px solid #10b981;">
            <h4 style="margin: 0 0 10px 0; color: #10b981;">使用流程</h4>
            <div style="font-size: 14px; line-height: 1.6;">
              <p style="margin: 0 0 8px 0;"><strong>1. 新建配置：</strong></p>
              <ul style="margin: 0 0 15px 0; padding-left: 20px;">
                <li>点击"示例"按钮生成示例配置</li>
                <li>或手动输入JSON配置</li>
                <li>使用可视化表格编辑配置</li>
              </ul>
              <p style="margin: 0 0 8px 0;"><strong>2. 保存配置：</strong></p>
              <ul style="margin: 0 0 15px 0; padding-left: 20px;">
                <li>按<code>Ctrl + S</code>或点击"保存"按钮</li>
                <li>输入配置名称</li>
                <li>配置将保存到本地存储</li>
              </ul>
              <p style="margin: 0 0 8px 0;"><strong>3. 生成代码：</strong></p>
              <ul style="margin: 0 0 15px 0; padding-left: 20px;">
                <li>按<code>Ctrl + Enter</code>或点击"生成"按钮</li>
                <li>系统将生成完整的项目代码</li>
                <li>可复制代码到项目中直接使用</li>
              </ul>
            </div>
          </div>

          <!-- 高级功能 -->
          <div
            style="margin-bottom: 20px; padding: 15px; background: #f3e8ff; border-radius: 8px; border-left: 4px solid #8b5cf6;">
            <h4 style="margin: 0 0 10px 0; color: #8b5cf6;">高级功能</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 14px;">
              <div><strong>🎨 模板自定义</strong>：修改代码生成模板</div>
              <div><strong>📤 配置导出</strong>：导出JSON配置分享</div>
              <div><strong>📥 配置导入</strong>：导入他人分享的配置</div>
              <div><strong>🗑️ 配置管理</strong>：删除不需要的配置</div>
              <div><strong>📋 示例生成</strong>：快速生成示例配置</div>
              <div><strong>🔧 数据库切换</strong>：MySQL/Oracle切换</div>
            </div>
          </div>

          <!-- 注意事项 -->
          <div
            style="margin-bottom: 20px; padding: 15px; background: #fef2f2; border-radius: 8px; border-left: 4px solid #ef4444;">
            <h4 style="margin: 0 0 10px 0; color: #ef4444;">注意事项</h4>
            <ul style="margin: 0; padding-left: 20px; font-size: 14px; line-height: 1.6;">
              <li>配置数据保存在浏览器本地存储中，清除浏览器数据会丢失</li>
              <li>生成的代码需要根据实际项目需求进行调整</li>
              <li>模板修改后需要保存配置才能生效</li>
              <li>建议定期导出重要配置作为备份</li>
              <li>所有快捷键在页面任何位置都有效</li>
              <li>支持多配置管理，可保存多个不同的项目配置</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="result-container">
      <!-- 添加浮动导航 -->
      <div class="floating-nav" id="floatingNav">
        <ul class="nav-list" id="navList">
          <div class="nav-left">
            <!-- 其余导航内容 -->
          </div>
        </ul>
      </div>
      <div id="result"></div>
    </div>
  </div>

  <!-- 提示容器 -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- 保存配置弹出框 -->
  <div id="saveConfigModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">保存配置</div>
      <div class="modal-body">
        <input type="text" id="projectName" placeholder="请输入配置名称">
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('saveConfigModal')">取消</button>
        <button class="btn-save" onclick="saveConfig()">保存</button>
      </div>
    </div>
  </div>

  <!-- 模板编辑模态框 -->
  <div id="templateModal" class="template-modal">
    <div class="template-modal-content">
      <div class="template-modal-header">
        <div class="template-modal-title">模板修改</div>
        <!-- 右上角关闭按钮已移除 -->
      </div>
      <div class="template-modal-body">
        <div class="template-tabs">
          <div class="template-tab active" onclick="switchTemplate('domain')">实体类模板</div>
          <div class="template-tab" onclick="switchTemplate('vo')">VO类模板</div>
          <div class="template-tab" onclick="switchTemplate('service')">Service接口模板</div>
          <div class="template-tab" onclick="switchTemplate('serviceImpl')">Service实现类模板</div>
          <div class="template-tab" onclick="switchTemplate('mapper')">Mapper模板</div>
          <div class="template-tab" onclick="switchTemplate('controller')">Controller模板</div>
          <div class="template-tab" onclick="switchTemplate('sql')">SQL模板</div>
        </div>
        <textarea id="templateEditor" class="template-editor"></textarea>
      </div>
      <div class="template-modal-footer">
        <button class="btn-secondary" onclick="closeModal('templateModal')">取消</button>
        <button class="btn-danger" onclick="resetTemplate()">重置模板</button>
        <button class="btn-save" onclick="saveTemplate()">保存修改</button>
      </div>
    </div>
  </div>

  <!-- 右下角返回顶部按钮 -->
  <div id="fixedBackToTop" class="back-to-top-fixed tooltip-container">
    <div class="back-to-top">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M12 7v10m0-10l-4 4m4-4l4 4" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
    </div>
    <div class="tooltip tooltip-top">返回顶部</div>
  </div>

  <!-- 说明弹窗 -->
  <div id="instructionModal" class="modal">
    <div class="modal-content" style="max-width:700px;">
      <div class="modal-header">使用说明</div>
      <div class="modal-body" id="instructionModalBody"></div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('instructionModal')">关闭</button>
      </div>
    </div>
  </div>

  <!-- 导入JSON配置弹窗（静态HTML实现） -->
  <div id="importJsonModal" class="modal" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">导入JSON配置</div>
      <div class="modal-body">
        <textarea id="importJsonInput" placeholder="请输入JSON配置"
          style="width:100%;height:200px;resize:vertical;"></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('importJsonModal')">取消</button>
        <button class="btn-save" onclick="importJsonFromText()">导入</button>
      </div>
    </div>
  </div>

  <!-- 删除配置确认弹窗 -->
  <div id="deleteConfigModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">删除配置</div>
      <div class="modal-body" id="deleteConfigModalBody">确定要删除配置吗？</div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('deleteConfigModal')">取消</button>
        <button class="btn-danger" id="deleteConfigModalConfirmBtn">删除</button>
      </div>
    </div>
  </div>

  <script>
    // 确保highlight.js在页面加载完成后初始化
    window.onload = function () {
      hljs.configure({
        languages: ['java', 'sql', 'json']
      });
      // 隐藏导航栏
      document.getElementById('floatingNav').style.display = 'none';
    };

    function camelToUnderline(str) {
      return str.replace(/([A-Z])/g, '_$1').replace(/^_/, '').toLowerCase();
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function parseFieldConfig(fieldName, config) {
      let [typeSpec, comment = ''] = config.split('|').map(s => s.trim());
      let typeName, params = '';
      let parenStart = typeSpec.indexOf('(');
      let parenEnd = typeSpec.lastIndexOf(')');
      if (parenStart > 0 && parenEnd > parenStart) {
        typeName = typeSpec.substring(0, parenStart).trim();
        params = typeSpec.substring(parenStart + 1, parenEnd);
      } else {
        typeName = typeSpec.trim();
      }
      let required = comment.startsWith('*');
      if (required) comment = comment.substring(1);
      let columnName = camelToUnderline(fieldName);
      return {
        name: fieldName,
        type: typeName,
        columnName,
        comment,
        required,
        params
      };
    }

    function mapToDataType(dbType, field) {
      let type = field.type.toLowerCase();
      let lengthParam = field.params.replace(/[^0-9,]/g, '');
      if (dbType === 'oracle') {
        switch (type) {
          case 'string':
            return `VARCHAR2(${lengthParam || 50})`;
          case 'integer':
            return 'NUMBER(10)';
          case 'long':
            return 'NUMBER(19)';
          case 'double':
          case 'bigdecimal': {
            let [precision, scale] = (lengthParam || '').split(',');
            precision = precision === undefined || precision === '' ? '20' : precision;
            scale = scale === undefined || scale === '' ? '0' : scale;
            return `NUMBER(${precision},${scale})`;
          }
          case 'date':
          case 'localdatetime':
            return 'DATE';
          case 'boolean':
            return 'NUMBER(1)';
          default:
            return 'VARCHAR2(100)';
        }
      } else {
        switch (type) {
          case 'string':
            return `VARCHAR(${lengthParam || 255})`;
          case 'integer':
            return 'INT';
          case 'long':
            return 'BIGINT';
          case 'double':
          case 'bigdecimal': {
            let [precision, scale] = (lengthParam || '').split(',');
            precision = precision === undefined || precision === '' ? '20' : precision;
            scale = scale === undefined || scale === '' ? '0' : scale;
            return `DECIMAL(${precision},${scale})`;
          }
          case 'date':
          case 'localdatetime':
            return 'DATETIME';
          case 'boolean':
            return 'TINYINT(1)';
          default:
            return 'VARCHAR(255)';
        }
      }
    }

    function genDomain(entityName, basePackage, fields, isOracle, dbType) {
      const templates = JSON.parse(localStorage.getItem('codeGeneratorTemplates') || '{}');
      let template = templates.domain || defaultTemplates.domain;

      // 替换模板变量
      let code = template
        .replace(/\${entityName}/g, entityName)
        .replace(/\${basePackage}/g, basePackage)
        .replace(/\${tableName}/g, isOracle ? camelToUnderline(entityName).toUpperCase() : camelToUnderline(entityName)
          .toLowerCase());

      // 生成字段代码
      let fieldsCode = fields.map(field => {
        let lines = [];
        if (field.comment) {
          lines.push(
            `    @ApiModelProperty(value = "${field.comment}"${field.required ? ', required = true' : ''})`);
        }
        if (field.name === 'id') {
          lines.push(`    @TableId(value = "id", type = ${dbType === 'mysql' ? 'IdType.AUTO' : 'IdType.INPUT'})`);
        }
        if (field.name === 'delFlag') lines.push(`    @TableLogic`);
        if (field.name === 'createTime') lines.push(`    @TableField(fill = FieldFill.INSERT)`);
        if (field.name === 'updateTime') lines.push(`    @TableField(fill = FieldFill.UPDATE)`);
        if (field.type === 'Date' || field.type === 'LocalDateTime') {
          let pattern = field.params || 'yyyy-MM-dd HH:mm:ss';
          lines.push(`    @JsonFormat(pattern = "${pattern}", timezone = "GMT+8")`);
        }
        lines.push(`    private ${field.type} ${field.name};`);
        return lines.join('\n');
      }).join('\n\n');

      // 替换字段占位符
      return code.replace('    // ... 其他字段 ...', fieldsCode);
    }

    function genVO(entityName, basePackage, fields) {
      const templates = JSON.parse(localStorage.getItem('codeGeneratorTemplates') || '{}');
      let template = templates.vo || defaultTemplates.vo;

      // 替换模板变量
      let code = template
        .replace(/\${entityName}/g, entityName)
        .replace(/\${basePackage}/g, basePackage);

      // 生成字段代码
      let fieldsCode = fields
        .filter(field => !['delFlag', 'createBy', 'createTime', 'updateBy', 'updateTime'].includes(field.name))
        .map(field => {
          let lines = [];
          if (field.comment) {
            lines.push(
              `    @ApiModelProperty(value = "${field.comment}"${field.required ? ', required = true' : ''})`);
          }
          if (field.required) {
            if (field.type === 'String') {
              lines.push(`    @NotBlank(message = "${field.comment}不能为空")`);
            } else {
              lines.push(`    @NotNull(message = "${field.comment}不能为空")`);
            }
          }
          if (field.type === 'String') {
            if (field.name.toLowerCase().includes('email')) {
              lines.push(`    @Email(message = "邮箱格式不正确")`);
            } else if (field.name.toLowerCase().includes('phone')) {
              lines.push(`    @Pattern(regexp = "^1[3-9]\d{9}$", message = "手机号格式不正确")`);
            }
            if (field.params && /^\d+/.test(field.params)) {
              let maxLength = parseInt(field.params.replace(/[^0-9]/g, ''));
              lines.push(`    @Size(max = ${maxLength}, message = "长度不能超过${maxLength}")`);
            }
          } else if (field.type === 'Integer' || field.type === 'Long') {
            lines.push(`    @Min(value = 0, message = "不能小于0")`);
          }
          if (field.type === 'Date' || field.type === 'LocalDateTime') {
            lines.push(`    @JsonFormat(pattern = "${field.params}", timezone = "GMT+8")`);
          }
          lines.push(`    private ${field.type} ${field.name};`);
          return lines.join('\n');
        }).join('\n\n');

      // 替换字段占位符
      return code.replace('    // ... 字段定义 ...', fieldsCode);
    }

    function genService(entityName, basePackage) {
      const templates = JSON.parse(localStorage.getItem('codeGeneratorTemplates') || '{}');
      let template = templates.service || defaultTemplates.service;

      return template
        .replace(/\${entityName}/g, entityName)
        .replace(/\${basePackage}/g, basePackage);
    }

    function genServiceImpl(entityName, basePackage) {
      const templates = JSON.parse(localStorage.getItem('codeGeneratorTemplates') || '{}');
      let template = templates.serviceImpl || defaultTemplates.serviceImpl;

      return template
        .replace(/\${entityName}/g, entityName)
        .replace(/\${basePackage}/g, basePackage);
    }

    function genMapper(entityName, basePackage) {
      const templates = JSON.parse(localStorage.getItem('codeGeneratorTemplates') || '{}');
      let template = templates.mapper || defaultTemplates.mapper;

      return template
        .replace(/\${entityName}/g, entityName)
        .replace(/\${basePackage}/g, basePackage);
    }

    function genController(entityName, basePackage, fields) {
      const templates = JSON.parse(localStorage.getItem('codeGeneratorTemplates') || '{}');
      let template = templates.controller || defaultTemplates.controller;

      let varName = entityName.charAt(0).toLowerCase() + entityName.slice(1);
      let tableName = camelToUnderline(entityName).toLowerCase();

      let code = template
        .replace(/\${entityName}/g, entityName)
        .replace(/\${basePackage}/g, basePackage)
        .replace(/\${varName}/g, varName)
        .replace(/\${tableName}/g, tableName);

      // 生成CRUD方法
      let methodsCode = `
@PostMapping("/add")
public AjaxResult create(@Valid @RequestBody ${entityName}VO vo) {
    return AjaxResult.success(${varName}Service
            .save(BeanUtil.copyProperties(vo, ${entityName}.class)
                    .setDelFlag(0)
                    // .setCreateBy("admin")
                    .setCreateTime(new Date()))
    );
}

@DeleteMapping("/delete/{id}")
public AjaxResult delete(@PathVariable Long id) {
    return AjaxResult.success(${varName}Service
            .updateById(new ${entityName}()
                    .setId(id)
                    .setDelFlag(1))
    );
}

@PutMapping("/update/{id}")
public AjaxResult update(@PathVariable Long id, @Valid @RequestBody ${entityName}VO vo) {
    return AjaxResult.success(${varName}Service
            .updateById(BeanUtil.copyProperties(vo, ${entityName}.class)
                    .setId(id)
                    // .setUpdateBy("admin")
                    .setUpdateTime(new Date()))
    );
}

@GetMapping("/get/{id}")
public AjaxResult getById(@PathVariable Long id) {
    ${entityName} po = ${varName}Service.getById(id);
    if (po == null) {
        return AjaxResult.error("未查询到当前数据，请检查！");
    }
    return AjaxResult.success(po);
}

@GetMapping("/list")
public AjaxResult list() {
    return AjaxResult.success(${varName}Service.lambdaQuery()
            .eq(${entityName}::getDelFlag, 0)
            .list()
    );
}

@GetMapping("/page")
public AjaxResult page(
        @RequestParam(required = false, defaultValue = "1") Integer current,
        @RequestParam(required = false, defaultValue = "10") Integer size,
        @Valid ${entityName}VO vo) {
    return AjaxResult.success(${varName}Service.page(new Page<>(current, size),
                    Wrappers.lambdaQuery(${entityName}.class)
                            .eq(${entityName}::getDelFlag, 0)${generateQueryConditions(entityName, fields)}
            )
    );
}`;

      // 替换CRUD方法占位符
      return code.replace('    // ... CRUD方法 ...', methodsCode);
    }

    function genSql(entityName, fields, dbType) {
      const templates = JSON.parse(localStorage.getItem('codeGeneratorTemplates') || '{}');
      let template = templates.sql || defaultTemplates.sql;

      let tableName = dbType === 'oracle' ? camelToUnderline(entityName).toUpperCase() : camelToUnderline(entityName)
        .toLowerCase();

      let code = template
        .replace(/\${entityName}/g, entityName)
        .replace(/\${tableName}/g, tableName);

      // 生成字段定义
      let fieldsCode = fields.map(field => {
        let dataType = mapToDataType(dbType, field);
        if (dbType === 'oracle') {
          // Oracle 字段定义不加注释
          return `    ${field.columnName.toUpperCase()} ${dataType}${field.required ? ' NOT NULL' : ''},`;
        } else {
          return `    ${field.columnName.toLowerCase()} ${dataType}${field.required ? ' NOT NULL' : ''} COMMENT '${field.comment}',`;
        }
      }).filter(Boolean).join('\n');

      // Oracle 字段注释
      let oracleComments = '';
      if (dbType === 'oracle') {
        oracleComments = fields
          .filter(field => field.comment)
          .map(field => `COMMENT ON COLUMN ${tableName}.${field.columnName.toUpperCase()} IS '${field.comment}';`)
          .join('\n');
        if (oracleComments) {
          code += '\n' + oracleComments;
        }
      }

      // 替换字段占位符
      return code.replace('    -- ... 其他字段 ...', fieldsCode);
    }

    function genJson(entityName, fields) {
      let validFields = fields.filter(f => !f.name.endsWith('Flag') && !f.name.endsWith('By') && !f.name.endsWith(
        'Time'));
      let json = {};
      for (let field of validFields) {
        if (field.type.toLowerCase() === 'string' && field.comment) {
          json[field.name] = field.comment;
        } else if (['integer', 'long'].includes(field.type.toLowerCase())) {
          json[field.name] = 1;
        } else if (['double', 'bigdecimal'].includes(field.type.toLowerCase())) {
          json[field.name] = 100.00;
        } else if (field.type.toLowerCase() === 'date' || field.type.toLowerCase() === 'localdatetime') {
          json[field.name] = field.params || '2023-01-01 00:00:00';
        } else if (field.type.toLowerCase() === 'boolean') {
          json[field.name] = true;
        } else {
          json[field.name] = '示例值';
        }
      }
      return JSON.stringify(json, null, 2);
    }

    function generateQueryConditions(entityName, fields) {
      let sb = [];
      for (let field of fields) {
        if (field.type === 'String' && !['id', 'delFlag', 'createBy', 'createTime', 'updateBy', 'updateTime'].includes(
          field.name)) {
          sb.push(
            `\n                                .like(vo.get${capitalize(field.name)}() != null, ${entityName}::get${capitalize(field.name)}, vo.get${capitalize(field.name)}())`
          );
        }
      }
      return sb.join('');
    }

    function _genAll(config) {
      let files = new Map();

      for (let entityKey in config) {
        let fieldsConfig = {
          ...config[entityKey]
        }; // 创建配置的副本
        let dbType = fieldsConfig.databases || 'mysql'; // 设置默认数据库类型
        delete fieldsConfig.databases; // 移除databases字段，不作为实体字段处理

        let parts = entityKey.split('.');
        let entityName = parts[parts.length - 1];
        let basePackage = parts.slice(0, parts.length - 1).join('.');

        // 处理字段
        let fields = [];
        // 只处理表格中实际存在的字段，不再自动添加id
        for (let fieldName in fieldsConfig) {
          try {
            let field = parseFieldConfig(fieldName, fieldsConfig[fieldName]);
            fields.push(field);
          } catch (e) {
            console.error(`处理字段 ${fieldName} 时出错:`, e);
          }
        }

        // 不再自动将id字段放最前面，顺序以表格为准

        let isOracle = dbType.toLowerCase() === 'oracle';

        try {
          // 生成所有代码文件
          let entityFiles = [{
            name: `${entityName}.java`,
            content: genDomain(entityName, basePackage, fields, isOracle, dbType),
            type: 'java',
            group: '1'
          },
          {
            name: `${entityName}Controller.java`,
            content: genController(entityName, basePackage, fields),
            type: 'java',
            group: '2'
          },
          {
            name: `${entityName}VO.java`,
            content: genVO(entityName, basePackage, fields),
            type: 'java',
            group: '3'
          },
          {
            name: `${entityName}Mapper.java`,
            content: genMapper(entityName, basePackage),
            type: 'java',
            group: '4'
          },
          {
            name: `I${entityName}Service.java`,
            content: genService(entityName, basePackage),
            type: 'java',
            group: '5'
          },
          {
            name: `${entityName}ServiceImpl.java`,
            content: genServiceImpl(entityName, basePackage),
            type: 'java',
            group: '6'
          },
          {
            name: `${entityName}.${dbType}.sql`,
            content: genSql(entityName, fields, dbType),
            type: 'sql',
            group: '7'
          },
          {
            name: `${entityName}.json`,
            content: genJson(entityName, fields),
            type: 'json',
            group: '8'
          }
          ];

          files.set(entityName, entityFiles);
        } catch (e) {
          console.error(`生成 ${entityName} 的代码时出错:`, e);
          throw new Error(`生成 ${entityName} 的代码时出错: ${e.message}`);
        }
      }
      return files;
    }

    function escapeHtml(str) {
      return str.replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function copyCode(btn) {
      const code = btn.closest('.file-header').nextElementSibling.querySelector('code');
      const text = code.innerText;
      navigator.clipboard.writeText(text);

      // 添加成功提示
      showToast('代码已复制', 'success');

      // 添加临时类以显示成功状态
      btn.style.backgroundColor = 'var(--success-color)';
      btn.style.boxShadow = '0 2px 8px rgba(16, 185, 129, 0.25)';

      setTimeout(() => {
        btn.style.backgroundColor = '';
        btn.style.boxShadow = '';
      }, 1200);
    }

    // 复制文本到剪贴板
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text);
      showToast('名称已复制', 'success');
    }

    // 从文件名中提取类名
    function extractClassName(fileName) {
      if (fileName.endsWith('.java')) {
        return fileName.substring(0, fileName.length - 5);
      }
      return fileName;
    }

    // 更新生成按钮状态
    function updateGenerateButton(error) {
      const container = document.querySelector('.generate-btn').closest('.tooltip-container');
      const errorTooltip = container.querySelector('.tooltip-error');
      if (error) {
        container.classList.add('error');
        errorTooltip.textContent = error;
        // 重置动画
        errorTooltip.style.animation = 'none';
        errorTooltip.offsetHeight; // 触发重排
        errorTooltip.style.animation = null;

        // 添加点击复制功能
        errorTooltip.onclick = () => copyToClipboard(error);
      } else {
        container.classList.remove('error');
        errorTooltip.textContent = '';
        errorTooltip.onclick = null;
      }
    }

    function generateCode() {
      // 让所有表格输入框自动失焦
      document.querySelectorAll('#configTableContainer input').forEach(input => input.blur());
      // 如果当前是新配置，强制重置模板为默认，并清除localStorage模板
      const header = document.querySelector('#mainConfigSelector .config-select-header');
      if (header && header.textContent === '新配置') {
        templateCache = { ...defaultTemplates };
        localStorage.removeItem('codeGeneratorTemplates');
      }
      syncConfigTableToJson();

      // 先移除所有错误高亮
      document.querySelectorAll('.field-comment-input, .entity-name-input').forEach(input => {
        input.classList.remove('input-error');
        input.style.borderColor = '';
      });

      // 先判断是否有实体
      if (!configTableData.length) {
        showToast('请先添加实体类。', 'error');
        return;
      }

      // 校验表格数据是否合法
      for (let i = 0; i < configTableData.length; i++) {
        const entity = configTableData[i];
        // 找到当前实体的表头输入框
        const entityCard = document.querySelectorAll('.entity-table-card')[i];
        const nameInput = entityCard ? entityCard.querySelector('input.field-comment-input') : null;
        const pkgInput = entityCard ? entityCard.querySelectorAll('input.field-comment-input')[1] : null;
        if (!entity.name || !entity.package) {
          if (nameInput && !entity.name) {
            nameInput.classList.add('input-error');
            nameInput.style.borderColor = '#dc2626';
          }
          if (pkgInput && !entity.package) {
            pkgInput.classList.add('input-error');
            pkgInput.style.borderColor = '#dc2626';
          }
          showToast(`第${i + 1}个实体的名称或包名不能为空。`, 'error');
          return;
        }
        for (let j = 0; j < entity.fields.length; j++) {
          const field = entity.fields[j];
          // 精确找到当前字段名输入框（只在tbody数据行里找）
          const fieldNameInput = document.querySelector(`.field-name-input[data-entity-idx="${i}"][data-field-idx="${j}"]`);
          if (!field.name) {
            if (fieldNameInput) {
              fieldNameInput.classList.add('input-error');
              fieldNameInput.style.borderColor = '#dc2626';
            }
            showToast(`实体"${entity.name}"的第${j + 1}个字段名不能为空。`, 'error');
            return;
          }
        }
      }

      const btn = document.querySelector('.generate-btn');
      let input = document.getElementById('jsonInput').value;
      let config;

      try {
        config = JSON.parse(input);
        updateGenerateButton(null);
      } catch (e) {
        let error = 'JSON 解析失败，请检查格式。';
        if (input == null || input == '') {
          error = 'JSON 不能为空。';
        }
        updateGenerateButton(error);
        return;
      }

      try {
        let codes = _genAll(config);
        let html = '';

        codes.forEach((codeList, entityName) => {
          html += `<div class="entity-cards">
        <div class='entity-card'>
          <div class='entity-header'>
            <div class='entity-title'>${entityName}</div>
          </div>
          <div class='files-grid'>`;

          for (const file of [...codeList]) {
            const fileType = file.name.split('.').pop();
            html += `
          <div class='file-block' id='${entityName}-${fileType}'>
            <div class='file-header'>
              <span class='code-title' onclick="copyToClipboard('${file.name.endsWith('.java') ? extractClassName(file.name) : file.name}')">${file.name}</span>
              <button class='copy-btn' onclick='copyCode(this)'>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M8 4v12a2 2 0 002 2h8a2 2 0 002-2V7.242a2 2 0 00-.602-1.43L16.083 2.57A2 2 0 0014.685 2H10a2 2 0 00-2 2z" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M16 18v2a2 2 0 01-2 2H6a2 2 0 01-2-2V9a2 2 0 012-2h2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
            <pre class='code-area'><code class='language-${file.type}'>${escapeHtml(file.content)}</code></pre>
          </div>`;
          }

          html += `
          </div>
        </div>
      </div>`;
        });

        document.getElementById('result').innerHTML = html;

        // 应用代码高亮
        document.querySelectorAll('pre code').forEach((block) => {
          hljs.highlightElement(block);
        });

        // 更新导航
        updateNavigation();

        // 显示生成成功提示
        showToast('代码生成成功！', 'success');
      } catch (e) {
        updateGenerateButton('生成代码出错：' + e.message);
        console.error('生成代码出错：', e);
      }
    }

    function scrollToElement(element) {
      const navHeight = document.querySelector('.floating-nav').offsetHeight;
      const elementPosition = element.getBoundingClientRect().top + window.pageYOffset;
      window.scrollTo({
        top: elementPosition - navHeight - 20,
        behavior: 'smooth'
      });
    }

    // 保存配置相关函数
    function showSaveConfigModal() {
      const config = document.getElementById('jsonInput').value.trim();
      if (!config) {
        showToast('请先输入配置内容。', 'warning');
        return;
      }
      try {
        // 验证JSON格式
        JSON.parse(config);
        // 检查主页面下拉框当前选中
        const header = document.querySelector('#mainConfigSelector .config-select-header');
        const currentName = header ? header.textContent : '';
        const projects = JSON.parse(localStorage.getItem('codeGeneratorProjects') || '{}');
        if (currentName && currentName !== '请选择配置' && currentName !== '新配置' && projects[currentName]) {
          // 只在已存在配置名时直接保存
          saveConfig(currentName);
        } else {
          // 弹出输入框
          openModal('saveConfigModal');
        }
      } catch (e) {
        showToast('配置格式不正确，请检查 JSON 格式。', 'error');
      }
    }

    function saveConfig(projectName) {
      if (!projectName) {
        // 从输入框获取配置名
        projectName = document.getElementById('projectName').value.trim();
        if (!projectName) {
          showToast('请输入配置名称。', 'error');
          return;
        }
      }
      const config = document.getElementById('jsonInput').value.trim();
      const projects = JSON.parse(localStorage.getItem('codeGeneratorProjects') || '{}');
      // 校验配置名是否已存在
      if (projects[projectName]) {
        showToast('配置名已存在，请更换名称。', 'error');
        return;
      }
      // 保存配置和模板
      projects[projectName] = {
        config: config,
        templates: {
          ...templateCache
        }
      };
      localStorage.setItem('codeGeneratorProjects', JSON.stringify(projects));
      closeModal('saveConfigModal');
      document.getElementById('projectName').value = '';
      // 更新主页面下拉框选中项
      renderMainConfigSelector();
      const header = document.querySelector('#mainConfigSelector .config-select-header');
      if (header) header.textContent = projectName;
      showToast('配置已保存');
    }

    let selectedProject = '';
    let deleteTimer = null;

    function showLoadConfigModal() {
      const optionsContainer = document.getElementById('configOptions');
      const header = document.querySelector('.config-select-header');
      // 清空现有选项
      optionsContainer.innerHTML = '';
      selectedProject = '';
      header.textContent = '请选择配置';

      // 添加点击事件来控制下拉菜单
      header.onclick = function (e) {
        e.stopPropagation();
        optionsContainer.classList.toggle('show');
      };

      // 获取保存的配置列表
      const projects = JSON.parse(localStorage.getItem('codeGeneratorProjects') || '{}');

      // 添加配置选项
      Object.keys(projects).forEach(projectName => {
        const option = document.createElement('div');
        option.className = 'config-option';
        option.innerHTML = `
      <span class="option-text">${projectName}</span>
      <div class="tooltip-container">
        <div class="delete-icon" data-project="${projectName}"></div>
        <div class="tooltip tooltip-top">删除配置</div>
      </div>
    `;

        // 点击选项
        option.onclick = (e) => {
          if (!e.target.closest('.delete-icon')) {
            selectedProject = projectName;
            header.textContent = projectName;
            document.querySelectorAll('.config-option').forEach(opt => {
              opt.classList.remove('selected');
            });
            option.classList.add('selected');
            optionsContainer.classList.remove('show');
          }
        };

        // 点击删除图标
        const deleteIcon = option.querySelector('.delete-icon');
        const tooltip = deleteIcon.parentElement.querySelector('.tooltip');
        deleteIcon.onclick = (e) => {
          e.stopPropagation();
          if (deleteIcon.classList.contains('confirm')) {
            // 第二次点击，执行删除
            const projects = JSON.parse(localStorage.getItem('codeGeneratorProjects') || '{}');
            delete projects[projectName];
            localStorage.setItem('codeGeneratorProjects', JSON.stringify(projects));
            option.remove();
            if (selectedProject === projectName) {
              selectedProject = '';
              header.textContent = '请选择配置';
            }
            showToast(`已删除配置：${projectName}`, 'success');
          } else {
            // 第一次点击，显示确认
            deleteIcon.classList.add('confirm');
            tooltip.textContent = '确认删除？';

            // 3秒后恢复
            if (deleteTimer) clearTimeout(deleteTimer);
            deleteTimer = setTimeout(() => {
              deleteIcon.classList.remove('confirm');
              tooltip.textContent = '删除配置';
            }, 3000);
          }
        };

        optionsContainer.appendChild(option);
      });

      if (Object.keys(projects).length === 0) {
        const emptyOption = document.createElement('div');
        emptyOption.className = 'config-option';
        emptyOption.textContent = '暂无保存的配置';
        optionsContainer.appendChild(emptyOption);
      }

      // 点击其他地方关闭下拉菜单
      document.addEventListener('click', function (e) {
        if (!e.target.closest('.config-selector')) {
          optionsContainer.classList.remove('show');
        }
      });

      document.getElementById('loadConfigModal').style.display = 'flex';
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    function loadConfig() {
      if (!selectedProject) {
        showToast('请选择配置。', 'warning');
        return;
      }

      const projects = JSON.parse(localStorage.getItem('codeGeneratorProjects') || '{}');
      const projectData = projects[selectedProject];

      if (projectData && projectData.config) {
        try {
          // 验证JSON格式
          JSON.parse(projectData.config);
          document.getElementById('jsonInput').value = projectData.config;

          // 加载模板
          if (projectData.templates) {
            templateCache = {
              ...defaultTemplates,
              ...projectData.templates
            };
          } else {
            templateCache = {
              ...defaultTemplates
            };
          }

          closeModal('loadConfigModal');
          // 更新配置区域标题
          document.querySelector('.section-title').textContent = `${selectedProject}`;
          showToast('配置已恢复。', 'success');
        } catch (e) {
          showToast('配置格式不正确，请检查。', 'error');
        }
      } else {
        showToast('未找到有效的配置。', 'warning');
      }
    }

    // 点击模态框外部关闭
    window.onclick = function (event) {
      if (event.target.className === 'modal') {
        event.target.style.display = 'none';
      }
    }

    function showToast(message, type = 'success', duration = 3000) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      const icon = type === 'success' ? '✓' : type === 'warning' ? '⚠' : type === 'info' ? '💡' : '✕';
      toast.innerHTML = `
    <span class="toast-icon">${icon}</span>
    <div class="toast-content">${message}</div>
    <span class="toast-close" onclick="this.parentElement.remove()">×</span>
  `;
      container.appendChild(toast);
      // 自定义时间后自动消失，带动画
      setTimeout(() => {
        toast.style.animation = 'slideOutLeft 0.3s cubic-bezier(.4,1.4,.6,1) forwards';
        setTimeout(() => toast.remove(), 300);
      }, duration);
    }

    function resetTitle() {
      document.querySelector('.section-title').textContent = '配置';
    }

    // 模板相关变量和函数
    let currentTemplate = 'domain';
    let templateCache = {}; // 用于缓存模板修改

    // 默认模板定义
    const defaultTemplates = {
      domain: `package \${basePackage}.domain;

import com.baomidou.mybatisplus.annotation.*;
import com.fasterxml.jackson.annotation.JsonFormat;
import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.experimental.Accessors;

import java.io.Serializable;
import java.math.BigDecimal;
import java.util.Date;

@Data
@Accessors(chain = true)
@EqualsAndHashCode(callSuper = false)
@TableName("\${tableName}")
@ApiModel(value = "\${entityName}对象", description = "\${entityName}实体")
public class \${entityName} implements Serializable {

private static final long serialVersionUID = 1L;

    // ... 其他字段 ...
}`,
      vo: `package \${basePackage}.vo;

import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;
import javax.validation.constraints.*;
import java.util.Date;
import java.math.BigDecimal;

@Data
@ApiModel(value = "\${entityName}VO对象", description = "\${entityName}展示对象")
public class \${entityName}VO {
    // ... 字段定义 ...
}`,
      service: `package \${basePackage}.service;

import com.baomidou.mybatisplus.extension.service.IService;
import \${basePackage}.domain.\${entityName};

public interface I\${entityName}Service extends IService<\${entityName}> {
}`,
      serviceImpl: `package \${basePackage}.service.impl;

import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import \${basePackage}.mapper.\${entityName}Mapper;
import \${basePackage}.service.I\${entityName}Service;
import \${basePackage}.domain.\${entityName};
import org.springframework.stereotype.Service;

@Service
public class \${entityName}ServiceImpl extends ServiceImpl<\${entityName}Mapper, \${entityName}> implements I\${entityName}Service {
}`,
      mapper: `package \${basePackage}.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import \${basePackage}.domain.\${entityName};
import org.apache.ibatis.annotations.Mapper;

@Mapper
public interface \${entityName}Mapper extends BaseMapper<\${entityName}> {
}`,
      controller: `package \${basePackage}.controller;

import cn.hutool.core.bean.BeanUtil;
import com.baomidou.mybatisplus.core.toolkit.Wrappers;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import \${basePackage}.domain.\${entityName};
import \${basePackage}.service.I\${entityName}Service;
import \${basePackage}.vo.\${entityName}VO;
import lombok.RequiredArgsConstructor;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;

import javax.validation.Valid;
import java.util.Date;

@Validated
@RestController
@RequiredArgsConstructor
@RequestMapping("/\${tableName}")
public class \${entityName}Controller {

private final I\${entityName}Service \${varName}Service;

    // ... CRUD方法 ...
}`,
      sql: `-- 创建\${entityName}表\nCREATE TABLE \${tableName} (\n    -- ... 其他字段 ...\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='\${entityName}表';`
    };

    // 添加快捷键监听
    document.addEventListener('keydown', function (e) {
      // 检查是否按下了 Ctrl + S
      if (e.ctrlKey && e.key.toLowerCase() === 's') {
        // 阻止默认的保存行为
        e.preventDefault();
        // 调用保存配置函数
        showSaveConfigModal();
      }
      // 检查是否按下了 Ctrl + Enter
      if (e.ctrlKey && e.key === 'Enter') {
        e.preventDefault();
        generateCode();
      }
      // 检查是否按下了 Ctrl + I
      if (e.ctrlKey && e.key.toLowerCase() === 'i') {
        e.preventDefault();
        showImportJsonModal();
      }
      // 检查是否按下了 Ctrl + E
      if (e.ctrlKey && e.key.toLowerCase() === 'e') {
        e.preventDefault();
        copyJsonToClipboard();
      }
      // 检查是否按下了 Ctrl + T
      if (e.ctrlKey && e.key.toLowerCase() === 't') {
        e.preventDefault();
        showTemplateModal();
      }
      // 检查是否按下了 Ctrl + H
      if (e.ctrlKey && e.key.toLowerCase() === 'h') {
        e.preventDefault();
        showInstructionModal();
      }
      // 检查是否按下了 Ctrl + D
      if (e.ctrlKey && e.key.toLowerCase() === 'd') {
        e.preventDefault();
        deleteCurrentConfig();
      }
    });

    // 初始化本地存储的模板
    function initTemplates() {
      // 获取主页面下拉框当前选中项
      const header = document.querySelector('#mainConfigSelector .config-select-header');
      const currentName = header ? header.textContent : '';
      const projects = JSON.parse(localStorage.getItem('codeGeneratorProjects') || '{}');
      if (currentName && currentName !== '新配置' && projects[currentName] && projects[currentName].templates) {
        templateCache = {
          ...defaultTemplates,
          ...projects[currentName].templates
        };
      } else {
        templateCache = {
          ...defaultTemplates
        };
      }
    }

    // 修改showTemplateModal，打开时重新initTemplates并刷新内容
    function showTemplateModal() {
      // 检查主页面下拉框当前选中
      const header = document.querySelector('#mainConfigSelector .config-select-header');
      const currentName = header ? header.textContent : '';
      const projects = JSON.parse(localStorage.getItem('codeGeneratorProjects') || '{}');
      if (!currentName || currentName === '新配置' || !projects[currentName]) {
        // 检查是否有配置内容
        const config = document.getElementById('jsonInput').value.trim();
        if (!config) {
          showToast('请先输入配置内容。', 'warning');
          return;
        }
        try {
          // 验证JSON格式
          JSON.parse(config);
          // 提示用户先保存配置
          showToast('请先保存配置后再修改模板', 'warning');
          // 打开保存配置对话框
          openModal('saveConfigModal');
        } catch (e) {
          showToast('配置格式不正确，请检查JSON格式', 'error');
        }
        return;
      }
      // 每次打开都重新加载最新模板
      initTemplates();
      openModal('templateModal');
      if (!currentTemplate) {
        currentTemplate = 'domain';
      }
      document.getElementById('templateEditor').value = templateCache[currentTemplate] || defaultTemplates[
        currentTemplate];
      // 更新tab激活状态
      document.querySelectorAll('.template-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelector(`.template-tab[onclick*="${currentTemplate}"]`).classList.add('active');
    }

    // 切换模板
    function switchTemplate(templateName) {
      // 保存当前模板的修改到缓存
      if (currentTemplate) {
        templateCache[currentTemplate] = document.getElementById('templateEditor').value;
      }

      currentTemplate = templateName;
      // 从缓存中恢复模板内容，如果缓存中没有则使用默认模板
      document.getElementById('templateEditor').value = templateCache[templateName] || defaultTemplates[templateName];

      // 更新tab激活状态
      document.querySelectorAll('.template-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelector(`.template-tab[onclick*="${templateName}"]`).classList.add('active');
    }

    // 保存模板修改
    function saveTemplate() {
      // 保存当前模板到缓存
      templateCache[currentTemplate] = document.getElementById('templateEditor').value;
      // 同步保存到全局模板，保证生成时生效
      localStorage.setItem('codeGeneratorTemplates', JSON.stringify(templateCache));
      // 获取主页面下拉框当前选中项
      const header = document.querySelector('#mainConfigSelector .config-select-header');
      const currentName = header ? header.textContent : '';
      const projects = JSON.parse(localStorage.getItem('codeGeneratorProjects') || '{}');
      if (currentName && currentName !== '新配置' && projects[currentName]) {
        // 直接保存到当前配置
        const currentProject = projects[currentName];
        if (currentProject) {
          currentProject.templates = {
            ...templateCache
          };
          localStorage.setItem('codeGeneratorProjects', JSON.stringify(projects));
          showToast('模板已保存');
          closeModal('templateModal');
        }
      } else {
        // 检查是否有配置内容
        const config = document.getElementById('jsonInput').value.trim();
        if (!config) {
          showToast('请先输入配置内容。', 'warning');
          return;
        }
        try {
          // 验证JSON格式
          JSON.parse(config);
          // 关闭模板框，打开保存配置对话框
          closeModal('templateModal');
          setTimeout(() => {
            openModal('saveConfigModal');
          }, 100);
        } catch (e) {
          showToast('配置格式不正确，请检查JSON格式', 'error');
        }
      }
    }

    // 重置模板
    function resetTemplate() {
      // 重置所有模板为默认内容
      Object.keys(defaultTemplates).forEach(key => {
        templateCache[key] = defaultTemplates[key];
      });
      // 刷新当前编辑器内容
      document.getElementById('templateEditor').value = templateCache[currentTemplate];
      showToast('所有模板已重置');
    }

    // 关闭模态框时保存缓存
    function closeModal(modalId) {
      if (modalId === 'templateModal') {
        // 保存当前模板到缓存
        templateCache[currentTemplate] = document.getElementById('templateEditor').value;
      }
      document.getElementById(modalId).style.display = 'none';
    }

    // 更新生成按钮状态
    function updateGenerateButton(error) {
      const container = document.querySelector('.generate-btn').closest('.tooltip-container');
      const errorTooltip = container.querySelector('.tooltip-error');
      if (error) {
        container.classList.add('error');
        errorTooltip.textContent = error;
        // 重置动画
        errorTooltip.style.animation = 'none';
        errorTooltip.offsetHeight; // 触发重排
        errorTooltip.style.animation = null;

        // 添加点击复制功能
        errorTooltip.onclick = () => copyToClipboard(error);
      } else {
        container.classList.remove('error');
        errorTooltip.textContent = '';
        errorTooltip.onclick = null;
      }
    }

    function updateNavigation() {
      const navList = document.getElementById('navList');
      const floatingNav = document.getElementById('floatingNav');
      const entities = document.querySelectorAll('.entity-card');

      // 如果没有实体，隐藏导航栏
      if (entities.length === 0) {
        floatingNav.style.display = 'none';
        return;
      }

      floatingNav.style.display = 'block';
      navList.innerHTML = '';

      // 创建左侧导航
      const navLeft = document.createElement('div');
      navLeft.className = 'nav-left';

      // 添加返回顶部按钮到左侧最前面
      const backToTop = document.createElement('div');
      backToTop.className = 'back-to-top';
      backToTop.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
    <path d="M12 7v10m0-10l-4 4m4-4l4 4" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>`;
      backToTop.onclick = () => {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      };
      const tooltip = document.createElement('div');
      tooltip.className = 'tooltip tooltip-top';
      tooltip.textContent = '返回顶部';

      // 创建实体选择器
      const entitySelector = document.createElement('div');
      entitySelector.className = 'entity-selector';

      const selectHeader = document.createElement('div');
      selectHeader.className = 'entity-select-header';
      selectHeader.textContent = '选择实体';

      const optionsContainer = document.createElement('div');
      optionsContainer.className = 'entity-select-options';

      // 存储所有实体的导航数据
      const entityNavs = new Map();

      entities.forEach((entity, index) => {
        const title = entity.querySelector('.entity-title').textContent;
        entity.id = `entity-${index}`;

        // 添加选项
        const option = document.createElement('div');
        option.className = 'entity-option';
        option.textContent = title;
        option.dataset.value = index;
        if (index === 0) {
          option.classList.add('selected');
          selectHeader.textContent = title;
        }

        option.onclick = function () {
          // 更新选中状态
          optionsContainer.querySelectorAll('.entity-option').forEach(opt => {
            opt.classList.remove('selected');
          });
          this.classList.add('selected');
          selectHeader.textContent = this.textContent;
          optionsContainer.classList.remove('show');
          selectHeader.classList.remove('active');

          // 更新导航组显示
          entityNavs.forEach((nav, idx) => {
            nav.style.display = idx === this.dataset.value ? 'flex' : 'none';
          });

          // 滚动到选中的实体
          const selectedEntity = document.getElementById(`entity-${this.dataset.value}`);
          if (selectedEntity) {
            scrollToElement(selectedEntity);
          }
        };

        optionsContainer.appendChild(option);

        // 创建导航组
        const navGroup = document.createElement('div');
        navGroup.className = 'nav-group';
        navGroup.style.display = 'none';

        // 收集文件类型
        const fileTypes = new Map();
        entity.querySelectorAll('.file-block').forEach(block => {
          const fileName = block.querySelector('.code-title').textContent;
          const fileType = fileName.split('.').pop();
          if (!fileTypes.has(fileType)) {
            fileTypes.set(fileType, []);
          }
          fileTypes.get(fileType).push({
            name: fileName,
            element: block
          });
        });

        // 处理 Java 文件
        if (fileTypes.has('java')) {
          const javaGroup = document.createElement('div');
          javaGroup.className = 'nav-java-group';

          const javaLink = document.createElement('a');
          javaLink.className = 'nav-link type-java';
          javaLink.textContent = 'Java';

          const subGroup = document.createElement('div');
          subGroup.className = 'nav-subgroup';

          const categories = [{
            name: 'Entity/Controller',
            pattern: f => !f.name.includes('VO') && !f.name.includes('Service') && !f.name.includes(
              'Controller') && !f.name.includes('Mapper')
          },
          {
            name: 'VO/Mapper',
            pattern: f => f.name.includes('VO')
          },
          {
            name: 'Service/Impl',
            pattern: f => f.name.includes('Service') && !f.name.includes('Impl')
          }
          ];

          const javaFiles = fileTypes.get('java');
          categories.forEach(category => {
            const files = javaFiles.filter(category.pattern);
            if (files.length > 0) {
              const link = document.createElement('a');
              link.href = `#${entity.id}-${files[0].name}`;
              link.className = 'nav-sublink';
              link.textContent = category.name;
              link.onclick = (e) => {
                e.preventDefault();
                scrollToElement(files[0].element);
              };
              subGroup.appendChild(link);
            }
          });

          javaGroup.appendChild(javaLink);
          javaGroup.appendChild(subGroup);
          navGroup.appendChild(javaGroup);
        }

        // 处理 SQL 和 JSON 文件，不包含在 Java 组内
        ['sql', 'json'].forEach(type => {
          if (fileTypes.has(type)) {
            const files = fileTypes.get(type);
            const typeLink = document.createElement('a');
            typeLink.href = `#${entity.id}-${files[0].name}`;
            typeLink.className = `nav-link type-${type.toLowerCase()}`;
            typeLink.textContent = type.toUpperCase();
            typeLink.onclick = (e) => {
              e.preventDefault();
              scrollToElement(files[0].element);
            };
            navGroup.appendChild(typeLink);
          }
        });

        entityNavs.set(index.toString(), navGroup);
      });

      entitySelector.appendChild(selectHeader);
      entitySelector.appendChild(optionsContainer);
      navLeft.appendChild(entitySelector);

      // 添加所有实体的导航组
      entityNavs.forEach(nav => {
        navLeft.appendChild(nav);
      });

      // 创建右侧导航
      const navRight = document.createElement('div');
      navRight.className = 'nav-right';

      // 添加左右两侧导航
      navList.appendChild(navLeft);
      navList.appendChild(navRight);

      // 显示第一个实体的导航
      if (entityNavs.has('0')) {
        entityNavs.get('0').style.display = 'flex';
      }

      // 移除点击事件，改为hover
      selectHeader.onclick = null;

      // 点击其他地方关闭下拉菜单
      document.addEventListener('click', function (e) {
        if (!e.target.closest('.config-selector')) {
          optionsContainer.classList.remove('show');
        }
      });
    }

    // 主页面配置下拉框渲染和切换逻辑
    function renderMainConfigSelector() {
      const selector = document.getElementById('mainConfigSelector');
      selector.innerHTML = '';
      const projects = JSON.parse(localStorage.getItem('codeGeneratorProjects') || '{}');
      let current = '新配置';
      const currentHeader = document.querySelector('.section-header .config-select-header');
      if (currentHeader && currentHeader.textContent && projects[currentHeader.textContent]) {
        current = currentHeader.textContent;
      }
      // 下拉头
      const header = document.createElement('div');
      header.className = 'config-select-header';
      header.textContent = current;
      selector.appendChild(header);
      // 下拉选项
      const options = document.createElement('div');
      options.className = 'config-select-options';
      // 新配置
      options.appendChild(createConfigOption('新配置', current === '新配置', () => {
        header.textContent = '新配置';
        options.classList.remove('show');
        header.classList.remove('active');
        document.getElementById('jsonInput').value = '';
        document.getElementById('result').innerHTML = '';
        document.getElementById('floatingNav').style.display = 'none';
        // 修复：切换到新配置时，重置模板缓存为默认模板
        templateCache = {
          ...defaultTemplates
        };
        currentTemplate = 'domain';
        showToast('已清空配置');
        configTableData = [];
        renderConfigTable();
      }));
      // 其它配置项
      Object.keys(projects).forEach(name => {
        options.appendChild(createConfigOption(name, current === name, () => {
          header.textContent = name;
          options.classList.remove('show');
          header.classList.remove('active');
          const projectData = projects[name];
          if (projectData && projectData.config) {
            document.getElementById('jsonInput').value = projectData.config;
            if (projectData.templates) {
              templateCache = {
                ...defaultTemplates,
                ...projectData.templates
              };
              localStorage.setItem('codeGeneratorTemplates', JSON.stringify(templateCache));
            } else {
              templateCache = { ...defaultTemplates };
              localStorage.setItem('codeGeneratorTemplates', JSON.stringify(templateCache));
            }
            showToast('配置已切换');
            jsonToConfigTable(projectData.config);
            // 切换配置时先清空生成代码面板
            document.getElementById('result').innerHTML = '';
            floatingNav.style.display = 'none';
            // 切换配置后自动生成代码
            setTimeout(() => { generateCode(); }, 0);
          }
        }, () => {
          delete projects[name];
          localStorage.setItem('codeGeneratorProjects', JSON.stringify(projects));
          renderMainConfigSelector();
          showToast(`已删除配置：${name}`);
          if (header.textContent === name) {
            header.textContent = '新配置';
            document.getElementById('jsonInput').value = '';
            document.getElementById('result').innerHTML = '';
            document.getElementById('floatingNav').style.display = 'none';
          }
        }));
      });
      selector.appendChild(options);
      bindMainConfigDropdownEvents(selector, options);
    }

    // 页面加载和每次保存/删除配置后都调用
    renderMainConfigSelector();

    // 弹窗键盘支持
    function addModalKeyEvents(modalId, onConfirm) {
      const modal = document.getElementById(modalId);

      function handler(e) {
        if (modal.style.display !== 'flex') return;
        if (e.key === 'Escape') {
          closeModal(modalId);
        } else if (e.key === 'Enter') {
          if (typeof onConfirm === 'function') onConfirm();
        }
      }
      modal._modalKeyHandler = handler;
      document.addEventListener('keydown', handler);
    }

    function removeModalKeyEvents(modalId) {
      const modal = document.getElementById(modalId);
      if (modal._modalKeyHandler) {
        document.removeEventListener('keydown', modal._modalKeyHandler);
        modal._modalKeyHandler = null;
      }
    }
    // 保存配置弹窗
    const saveConfigModal = document.getElementById('saveConfigModal');
    saveConfigModal.addEventListener('show', function () {
      addModalKeyEvents('saveConfigModal', saveConfig);
    });
    saveConfigModal.addEventListener('hide', function () {
      removeModalKeyEvents('saveConfigModal');
    });
    // 模板弹窗
    const templateModal = document.getElementById('templateModal');
    templateModal.addEventListener('show', function () {
      addModalKeyEvents('templateModal', saveTemplate);
    });
    templateModal.addEventListener('hide', function () {
      removeModalKeyEvents('templateModal');
    });
    // 修改open/closeModal函数，触发show/hide事件
    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modalId === 'templateModal') {
        templateCache[currentTemplate] = document.getElementById('templateEditor').value;
      }
      modal.style.display = 'none';
      const evt = new Event('hide');
      modal.dispatchEvent(evt);
    }

    function openModal(modalId) {
      const modal = document.getElementById(modalId);
      modal.style.display = 'flex';
      const evt = new Event('show');
      modal.dispatchEvent(evt);
      // 自动聚焦保存配置输入框
      if (modalId === 'saveConfigModal') {
        setTimeout(() => {
          const input = document.getElementById('projectName');
          if (input) input.focus();
        }, 0);
      }
    }

    // 创建配置选项
    function createConfigOption(name, isSelected, onClick, onDelete) {
      const opt = document.createElement('div');
      opt.className = 'config-option' + (isSelected ? ' selected' : '');
      opt.innerHTML =
        `<span class="option-text">${name}</span>${name !== '新配置' ? '<div class="delete-icon"></div>' : ''}`;
      opt.onclick = (e) => {
        if (e.target.classList.contains('delete-icon')) return;
        onClick && onClick();
      };
      if (name !== '新配置') {
        const deleteIcon = opt.querySelector('.delete-icon');
        let deleteTimer = null;
        deleteIcon.onclick = (e) => {
          e.stopPropagation();
          if (deleteIcon.classList.contains('confirm')) {
            onDelete && onDelete();
          } else {
            deleteIcon.classList.add('confirm');
            if (deleteTimer) clearTimeout(deleteTimer);
            deleteTimer = setTimeout(() => {
              deleteIcon.classList.remove('confirm');
            }, 2000);
          }
        };
      }
      return opt;
    }

    // 绑定主页面配置下拉框事件
    function bindMainConfigDropdownEvents(selector, options) {
      let showTimer = null;
      let hideTimer = null;
      const header = selector.querySelector('.config-select-header');

      function updateSelected() {
        const opts = options.querySelectorAll('.config-option');
        opts.forEach(opt => {
          if (opt.querySelector('.option-text') && opt.querySelector('.option-text').textContent === header
            .textContent) {
            opt.classList.add('selected');
          } else {
            opt.classList.remove('selected');
          }
        });
      }

      function showDropdown() {
        clearTimeout(hideTimer);
        options.classList.add('show');
        header.classList.add('active');
        updateSelected();
      }

      function hideDropdown() {
        clearTimeout(showTimer);
        options.classList.remove('show');
        header.classList.remove('active');
      }
      header.onclick = function (e) {
        e.stopPropagation();
        if (options.classList.contains('show')) {
          hideDropdown();
        } else {
          showDropdown();
        }
      };
      selector.addEventListener('mouseenter', showDropdown);
      selector.addEventListener('mouseleave', hideDropdown);
      document.addEventListener('click', function docClick(e) {
        if (!e.target.closest('#mainConfigSelector')) {
          hideDropdown();
        }
      });
      window.addEventListener('unload', function () {
        document.removeEventListener('click', docClick);
      });
    }

    // 右下角返回顶部按钮逻辑
    document.getElementById('fixedBackToTop').onclick = function () {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    };
    // 滚动时显示/隐藏
    window.addEventListener('scroll', function () {
      const btn = document.getElementById('fixedBackToTop');
      if (window.scrollY > 200) {
        btn.style.opacity = '1';
        btn.style.pointerEvents = 'auto';
      } else {
        btn.style.opacity = '0';
        btn.style.pointerEvents = 'none';
      }
    });
    // 初始隐藏
    document.getElementById('fixedBackToTop').style.opacity = '0';
    document.getElementById('fixedBackToTop').style.pointerEvents = 'none';

    // 配置表格数据结构
    let configTableData = [];

    // 渲染配置表格
    function renderConfigTable() {
      const container = document.getElementById('configTableContainer');
      container.innerHTML = '';
      if (!configTableData.length) {
        container.innerHTML = '';
      }
      // 新配置时显示新建类按钮
      const header = document.querySelector('#mainConfigSelector .config-select-header');
      configTableData.forEach((entity, entityIdx) => {
        const entityDiv = document.createElement('div');
        entityDiv.className = 'entity-table-card';
        entityDiv.style =
          'margin-bottom:2rem;box-shadow:0 2px 8px rgba(0,0,0,0.06);border-radius:8px;border:1px solid #e2e8f0;animation:fadeIn 0.3s;';
        // 构建表头
        const headerDiv = document.createElement('div');
        headerDiv.className = 'entity-table-header';
        // 左侧输入区
        const leftDiv = document.createElement('div');
        leftDiv.style = 'display:flex;align-items:center;gap:0.5rem;';
        // 实体名输入
        const nameInput = document.createElement('input');
        nameInput.className = 'field-comment-input entity-name-input';
        nameInput.value = entity.name;
        nameInput.placeholder = "实体名";
        nameInput.onchange = function () {
          updateEntityName(entityIdx, this.value);
        };
        nameInput.onblur = function () {
          syncConfigTableToJson();
          // 实体名失焦校验
          if (!this.value) {
            this.classList.add('input-error');
            this.style.borderColor = '#dc2626';
            showToast('实体名称不能为空。', 'error');
          } else {
            this.classList.remove('input-error');
            this.style.borderColor = '';
          }
        };
        leftDiv.appendChild(nameInput);
        // 包名输入
        const pkgInput = document.createElement('input');
        pkgInput.className = 'field-comment-input entity-package-input';
        pkgInput.value = entity.package;
        pkgInput.placeholder = "包名";
        pkgInput.onchange = function () {
          updateEntityPackage(entityIdx, this.value);
        };
        pkgInput.onblur = function () {
          syncConfigTableToJson();
          // 包名失焦校验
          if (!this.value) {
            this.classList.add('input-error');
            this.style.borderColor = '#dc2626';
            showToast('包名不能为空。', 'error');
          } else {
            this.classList.remove('input-error');
            this.style.borderColor = '';
          }
        };
        leftDiv.appendChild(pkgInput);
        // 数据库类型下拉
        const dbTypeSelector = document.createElement('div');
        dbTypeSelector.className = 'config-selector';
        dbTypeSelector.style.minWidth = '120px';
        const dbTypeHeader = document.createElement('div');
        dbTypeHeader.className = 'config-select-header';
        dbTypeHeader.textContent = entity.dbType === 'oracle' ? 'Oracle' : 'MySQL';
        dbTypeSelector.appendChild(dbTypeHeader);
        const dbTypeOptions = document.createElement('div');
        dbTypeOptions.className = 'config-select-options';
        [{
          value: 'mysql',
          label: 'MySQL'
        },
        {
          value: 'oracle',
          label: 'Oracle'
        }
        ].forEach(opt => {
          const option = document.createElement('div');
          option.className = 'config-option' + (entity.dbType === opt.value ? ' selected' : '');
          option.textContent = opt.label;
          option.onclick = () => {
            updateEntityDbType(entityIdx, opt.value);
            dbTypeHeader.textContent = opt.label;
            dbTypeOptions.classList.remove('show');
            dbTypeHeader.classList.remove('active');
          };
          dbTypeOptions.appendChild(option);
        });
        dbTypeSelector.appendChild(dbTypeOptions);
        dbTypeHeader.onclick = function (e) {
          e.stopPropagation();
          const isOpen = dbTypeOptions.classList.contains('show');
          closeAllConfigDropdowns();
          if (!isOpen) {
            // 修复：展开时高亮当前选中项
            Array.from(dbTypeOptions.children).forEach(optDiv => {
              if (optDiv.textContent === dbTypeHeader.textContent) {
                optDiv.classList.add('selected');
              } else {
                optDiv.classList.remove('selected');
              }
            });
            dbTypeOptions.classList.add('show');
            dbTypeHeader.classList.add('active');
          }
        };
        leftDiv.appendChild(dbTypeSelector);
        headerDiv.appendChild(leftDiv);
        // 右侧操作按钮区
        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'entity-actions';
        // 添加系统字段按钮（绿色，outline）
        actionsDiv.appendChild(createButton({
          color: 'green',
          className: 'action-btn action-btn-green-outline',
          icon: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg>`,
          tooltip: '添加系统字段',
          onClick: () => addDefaultFields(entityIdx)
        }));
        // 复制JSON按钮（蓝色，outline）
        actionsDiv.appendChild(createButton({
          color: 'blue',
          className: 'action-btn copy-btn action-btn-blue-outline',
          icon: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`,
          tooltip: '复制JSON',
          onClick: () => copyEntityJson(entityIdx)
        }));
        // 删除实体按钮（红色）
        actionsDiv.appendChild(createButton({
          color: 'red',
          className: 'action-btn delete-btn',
          icon: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2M10 11v6M14 11v6"></path></svg>`,
          tooltip: '删除实体',
          onClick: () => removeEntity(entityIdx)
        }));
        headerDiv.appendChild(actionsDiv);
        entityDiv.appendChild(headerDiv);
        // 其余表格和字段部分仍用原有模板渲染
        // 字段表格
        const fieldsDiv = document.createElement('div');
        fieldsDiv.className = 'entity-table-fields';
        // 表格
        const table = document.createElement('table');
        table.className = 'fields-table';
        // 表头
        table.innerHTML = `
      <thead>
        <tr>
          <th style="width:4%">序号</th>
          <th style="width:20%">字段名</th>
          <th style="width:26%">类型(参数)</th>
          <th style="width:28%">注释</th>
          <th style="width:4%">必填</th>
          <th style="width:18%">操作</th>
        </tr>
      </thead>
    `;
        // 表体
        const tbody = document.createElement('tbody');
        entity.fields.forEach((field, fieldIdx) => {
          const tr = createFieldRow(entityIdx, fieldIdx);
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        fieldsDiv.appendChild(table);
        // 添加字段按钮
        const addFieldRow = document.createElement('div');
        addFieldRow.className = 'add-field-row';
        const addBtn = createButton({
          type: 'table-bottom',
          className: 'add-field-btn',
          icon: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg>`,
          tooltip: '添加字段',
          onClick: () => addField(entityIdx)
        });
        addBtn.style.width = '100%';
        addBtn.style.display = 'flex';
        addBtn.style.justifyContent = 'center';
        addBtn.style.alignItems = 'center';
        addFieldRow.appendChild(addBtn);
        fieldsDiv.appendChild(addFieldRow);
        entityDiv.appendChild(fieldsDiv);
        container.appendChild(entityDiv);
      });
      // 添加实体按钮（div+svg+tooltip，顺序保证无报错）
      Array.from(container.querySelectorAll('.add-entity-block-btn')).forEach(e => e.remove());
      const tooltipWrapper = document.createElement('div');
      tooltipWrapper.className = 'tooltip-container';
      tooltipWrapper.style.width = '100%';
      const addBlockBtn = document.createElement('div');
      addBlockBtn.className = 'add-entity-block-btn';
      addBlockBtn.title = '';
      addBlockBtn.style.width = '100%';
      addBlockBtn.style.height = '54px';
      addBlockBtn.style.display = 'flex';
      addBlockBtn.style.alignItems = 'center';
      addBlockBtn.style.justifyContent = 'center';
      addBlockBtn.style.cursor = 'pointer';
      addBlockBtn.innerHTML =
        `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 5v14M5 12h14" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
      addBlockBtn.onclick = addEntity;
      const tooltip = document.createElement('div');
      tooltip.className = 'tooltip tooltip-top';
      tooltip.textContent = '新建实体类';
      tooltipWrapper.appendChild(addBlockBtn);
      tooltipWrapper.appendChild(tooltip);
      addBlockBtn.onmouseenter = () => {
        tooltip.style.opacity = '1';
        tooltip.style.visibility = 'visible';
      };
      addBlockBtn.onmouseleave = () => {
        tooltip.style.opacity = '0';
        tooltip.style.visibility = 'hidden';
      };
      container.appendChild(tooltipWrapper);
      syncConfigTableToJson();
    }

    // 表格操作函数
    function addEntity() {
      // 获取上一个实体的信息
      const lastEntity = configTableData[configTableData.length - 1];
      const newEntity = {
        name: 'NewEntity',
        package: lastEntity ? lastEntity.package : 'com.example',
        dbType: lastEntity ? lastEntity.dbType : 'mysql',
        fields: [{
          name: 'id',
          type: 'BigDecimal(20,0)', // 只用 BigDecimal
          comment: '主键',
          required: true
        }]
      };

      configTableData.push(newEntity);
      renderConfigTable();

      // 自动聚焦到新实体的名称输入框
      setTimeout(() => {
        const inputs = document.querySelectorAll('.entity-name-input');
        const lastInput = inputs[inputs.length - 1];
        if (lastInput) {
          lastInput.focus();
          lastInput.select();
        }
      }, 100);
    }

    function removeEntity(idx) {
      configTableData.splice(idx, 1);
      renderConfigTable();
    }

    function updateEntityName(idx, val) {
      configTableData[idx].name = val;
      syncConfigTableToJson();
    }

    function updateEntityPackage(idx, val) {
      configTableData[idx].package = val;
      syncConfigTableToJson();
    }

    function updateEntityDbType(idx, val) {
      configTableData[idx].dbType = val;
      syncConfigTableToJson();
    }

    function addField(entityIdx) {
      configTableData[entityIdx].fields.push({
        name: '',
        type: 'String(50)',
        comment: '',
        required: false
      });
      // 只插入新行，不刷新整个表格
      const container = document.getElementById('configTableContainer');
      const tables = container.querySelectorAll('.fields-table');
      if (!tables[entityIdx]) return;
      const tbody = tables[entityIdx].querySelector('tbody');
      const fieldIdx = configTableData[entityIdx].fields.length - 1;
      const newTr = createFieldRow(entityIdx, fieldIdx);
      tbody.appendChild(newTr);
      // 新增：刷新原最后一行，使其操作区包含下移按钮
      if (fieldIdx > 0) {
        const prevTr = tbody.querySelectorAll('tr')[fieldIdx - 1];
        if (prevTr) {
          const newPrevTr = createFieldRow(entityIdx, fieldIdx - 1);
          prevTr.parentNode.replaceChild(newPrevTr, prevTr);
        }
      }
      syncConfigTableToJson();
    }

    function removeField(entityIdx, fieldIdx) {
      configTableData[entityIdx].fields.splice(fieldIdx, 1);
      // 只移除当前行，不刷新整个表格，增加动画
      const container = document.getElementById('configTableContainer');
      const tables = container.querySelectorAll('.fields-table');
      if (!tables[entityIdx]) return;
      const tbody = tables[entityIdx].querySelector('tbody');
      const trs = Array.from(tbody.querySelectorAll('tr'));
      const tr = trs[fieldIdx];
      if (tr) {
        tr.style.animation = 'slideOut 0.3s cubic-bezier(.4,1.4,.6,1) forwards';
        tr.addEventListener('animationend', function handler() {
          tr.removeEventListener('animationend', handler);
          if (tr.parentNode) tr.parentNode.removeChild(tr);
          // 删除后，刷新后续所有行的序号和操作区（按钮）
          for (let i = fieldIdx; i < configTableData[entityIdx].fields.length; i++) {
            const oldTr = tbody.querySelectorAll('tr')[i];
            if (oldTr) {
              const newTr = createFieldRow(entityIdx, i);
              oldTr.parentNode.replaceChild(newTr, oldTr);
            }
          }
          syncConfigTableToJson();
        });
      } else {
        // 没有tr，直接刷新后续
        for (let i = fieldIdx; i < configTableData[entityIdx].fields.length; i++) {
          const oldTr = tbody.querySelectorAll('tr')[i];
          if (oldTr) {
            const newTr = createFieldRow(entityIdx, i);
            oldTr.parentNode.replaceChild(newTr, oldTr);
          }
        }
        syncConfigTableToJson();
      }
    }

    function updateField(entityIdx, fieldIdx, key, val) {
      if (key === 'required') val = !!val;
      configTableData[entityIdx].fields[fieldIdx][key] = val;
      syncConfigTableToJson();
    }

    // 只交换数据，不移动 tr，按钮事件始终和 tr 索引一致
    function moveField(entityIdx, fieldIdx, direction) {
      const fields = configTableData[entityIdx].fields;
      const newIdx = direction === 'up' ? fieldIdx - 1 : fieldIdx + 1;
      if (newIdx < 0 || newIdx >= fields.length) return;
      // 只交换数据
      [fields[fieldIdx], fields[newIdx]] = [fields[newIdx], fields[fieldIdx]];
      const container = document.getElementById('configTableContainer');
      const tables = container.querySelectorAll('.fields-table');
      if (!tables[entityIdx]) return;
      const tbody = tables[entityIdx].querySelector('tbody');
      const trs = Array.from(tbody.querySelectorAll('tr'));
      const trA = trs[fieldIdx];
      const trB = trs[newIdx];
      if (!trA || !trB) return;
      // 添加动画
      if (direction === 'up') {
        trA.classList.add('tr-move-up');
        trB.classList.add('tr-move-down');
      } else {
        trA.classList.add('tr-move-down');
        trB.classList.add('tr-move-up');
      }
      // 动画结束后完整替换两行，保证按钮区和交互正确
      trA.addEventListener('animationend', function handlerA() {
        trA.classList.remove('tr-move-up', 'tr-move-down');
        const newTrA = createFieldRow(entityIdx, fieldIdx);
        trA.parentNode.replaceChild(newTrA, trA);
        trA.removeEventListener('animationend', handlerA);
      });
      trB.addEventListener('animationend', function handlerB() {
        trB.classList.remove('tr-move-up', 'tr-move-down');
        const newTrB = createFieldRow(entityIdx, newIdx);
        trB.parentNode.replaceChild(newTrB, trB);
        trB.removeEventListener('animationend', handlerB);
      });
      syncConfigTableToJson();
    }

    // 只刷新 tr 内容，不动事件
    function updateFieldRowContent(tr, entityIdx, fieldIdx) {
      const field = configTableData[entityIdx].fields[fieldIdx];
      // 序号
      const indexCell = tr.querySelector('td:first-child');
      if (indexCell) indexCell.textContent = fieldIdx + 1;
      // 字段名
      const nameInput = tr.querySelector('.field-name-input');
      if (nameInput) nameInput.value = field.name;
      // 类型
      const typeHeader = tr.querySelector('.config-select-header');
      if (typeHeader) typeHeader.textContent = field.type.split('(')[0];
      // 注释
      const commentInput = tr.querySelector('.field-comment-input');
      if (commentInput) commentInput.value = field.comment;
      // 必填
      const requiredCheckbox = tr.querySelector('.field-required-checkbox');
      if (requiredCheckbox) requiredCheckbox.checked = !!field.required;
      // 你可以根据实际表格结构补充更多字段
    }

    // 单行渲染函数，供动画后精准替换
    function createFieldRow(entityIdx, fieldIdx) {
      const entity = configTableData[entityIdx];
      const field = entity.fields[fieldIdx];
      const tr = document.createElement('tr');
      tr.setAttribute('data-field-idx', fieldIdx);
      // 序号
      const tdIndex = document.createElement('td');
      tdIndex.style.textAlign = 'center';
      tdIndex.style.fontWeight = '500';
      tdIndex.style.color = 'var(--text-secondary)';
      tdIndex.textContent = fieldIdx + 1;
      tr.appendChild(tdIndex);
      // 字段名
      const tdName = document.createElement('td');
      const nameInput = document.createElement('input');
      nameInput.className = 'field-comment-input field-name-input';
      nameInput.value = field.name;
      nameInput.setAttribute('data-entity-idx', entityIdx);
      nameInput.setAttribute('data-field-idx', fieldIdx);
      nameInput.onchange = function () {
        updateField(entityIdx, fieldIdx, 'name', this.value);
      };
      nameInput.onblur = function () {
        syncConfigTableToJson();
        // 字段名失焦校验
        if (!this.value) {
          this.classList.add('input-error');
          this.style.borderColor = '#dc2626';
          showToast('字段名不能为空。', 'error');
        } else {
          this.classList.remove('input-error');
          this.style.borderColor = '';
        }
      };
      tdName.appendChild(nameInput);
      tr.appendChild(tdName);
      // 类型
      const tdType = document.createElement('td');
      const typeDiv = document.createElement('div');
      typeDiv.className = 'type-select-container';
      typeDiv.innerHTML = '';
      // 类型下拉
      const typeSelector = document.createElement('div');
      typeSelector.className = 'config-selector';
      typeSelector.style.minWidth = '100px';
      const typeHeader = document.createElement('div');
      typeHeader.className = 'config-select-header';
      typeHeader.textContent = field.type.split('(')[0];
      typeSelector.appendChild(typeHeader);
      const typeOptions = document.createElement('div');
      typeOptions.className = 'config-select-options';
      [
        { value: 'String', label: 'String' },
        { value: 'Integer', label: 'Integer' },
        { value: 'Boolean', label: 'Boolean' },
        { value: 'BigDecimal', label: 'BigDecimal' },
        { value: 'LocalDateTime', label: 'LocalDateTime' }
      ].forEach(opt => {
        const option = document.createElement('div');
        option.className = 'config-option' + (field.type.split('(')[0] === opt.value ? ' selected' : '');
        option.textContent = opt.label;
        option.onclick = () => {
          updateFieldType(entityIdx, fieldIdx, opt.value);
          typeHeader.textContent = opt.label;
          typeOptions.classList.remove('show');
          typeHeader.classList.remove('active');
        };
        typeOptions.appendChild(option);
      });
      typeSelector.appendChild(typeOptions);
      typeHeader.onclick = function (e) {
        e.stopPropagation();
        const isOpen = typeOptions.classList.contains('show');
        closeAllConfigDropdowns();
        if (!isOpen) {
          // 修复：展开时高亮当前选中项
          Array.from(typeOptions.children).forEach(optDiv => {
            if (optDiv.textContent === typeHeader.textContent) {
              optDiv.classList.add('selected');
            } else {
              optDiv.classList.remove('selected');
            }
          });
          typeOptions.classList.add('show');
          typeHeader.classList.add('active');
        }
      };
      typeDiv.appendChild(typeSelector);
      // 类型参数
      let paramInput, paramInput2;
      const mainType = field.type.split('(')[0];
      if (field.type && field.type.indexOf('BigDecimal') !== -1) {
        let paramStr = getTypeParam(field.type);
        let precision = '', scale = '';
        if (paramStr && paramStr.includes(',')) {
          [precision, scale] = paramStr.split(',');
        } else if (paramStr) {
          precision = paramStr;
          scale = '2';
        } else {
          precision = '10';
          scale = '2';
        }
        paramInput = document.createElement('input');
        paramInput.className = 'field-type-param field-comment-input show';
        paramInput.placeholder = '精度';
        paramInput.style.width = '48%';
        paramInput.value = precision;
        paramInput.onchange = function () {
          updateFieldTypeParam(entityIdx, fieldIdx, this.value + ',' + paramInput2.value);
        };
        paramInput2 = document.createElement('input');
        paramInput2.className = 'field-type-param field-comment-input show';
        paramInput2.placeholder = '小数位';
        paramInput2.style.width = '48%';
        paramInput2.value = scale;
        paramInput2.onchange = function () {
          updateFieldTypeParam(entityIdx, fieldIdx, paramInput.value + ',' + this.value);
        };
        typeDiv.appendChild(paramInput);
        typeDiv.appendChild(paramInput2);
      } else {
        paramInput = document.createElement('input');
        paramInput.className = 'field-type-param field-comment-input show';
        paramInput.placeholder = '参数';
        paramInput.value = getTypeParam(field.type);
        // 优化：如果没有参数输入框（如Integer、Boolean），让类型下拉框本身和父容器都宽度100%
        if (mainType === 'Integer' || mainType === 'Boolean') {
          paramInput.style.display = 'none';
          typeDiv.style.width = '100%';
          typeSelector.style.width = '100%';
        } else {
          paramInput.style.width = '100%';
          paramInput.style.display = 'block';
          typeDiv.style.width = '';
          typeSelector.style.width = '';
        }
        paramInput.onchange = function () {
          updateFieldTypeParam(entityIdx, fieldIdx, this.value);
        };
        typeDiv.appendChild(paramInput);
      }
      tdType.appendChild(typeDiv);
      tr.appendChild(tdType);
      // 注释
      const tdComment = document.createElement('td');
      tdComment.style.width = '22%';
      const commentInput = document.createElement('input');
      commentInput.className = 'field-comment-input';
      commentInput.value = field.comment;
      commentInput.onchange = function () {
        updateField(entityIdx, fieldIdx, 'comment', this.value);
      };
      tdComment.appendChild(commentInput);
      tr.appendChild(tdComment);
      // 必填
      const tdRequired = document.createElement('td');
      tdRequired.style.textAlign = 'center';
      tdRequired.style.width = '10%';
      const requiredInput = document.createElement('input');
      requiredInput.type = 'checkbox';
      requiredInput.checked = !!field.required;
      requiredInput.onchange = function () {
        updateField(entityIdx, fieldIdx, 'required', this.checked);
      };
      tdRequired.appendChild(requiredInput);
      tr.appendChild(tdRequired);
      // 操作按钮
      const tdActions = document.createElement('td');
      tdActions.style.width = '20%';
      const actionsDiv = document.createElement('div');
      actionsDiv.className = 'field-actions';
      // 上移
      if (fieldIdx > 0) actionsDiv.appendChild(createButton({
        type: 'table',
        className: 'move-btn',
        icon: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M5 12l7-7 7 7"/></svg>`,
        tooltip: '上移字段',
        onClick: () => moveField(entityIdx, fieldIdx, 'up')
      }));
      // 下移
      if (fieldIdx < entity.fields.length - 1) actionsDiv.appendChild(createButton({
        type: 'table',
        className: 'move-btn',
        icon: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12l7 7 7-7"/></svg>`,
        tooltip: '下移字段',
        onClick: () => moveField(entityIdx, fieldIdx, 'down')
      }));
      // 删除
      actionsDiv.appendChild(createButton({
        type: 'danger',
        className: 'delete-btn',
        icon: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2M10 11v6M14 11v6"></path></svg>`,
        tooltip: '删除字段',
        onClick: () => removeField(entityIdx, fieldIdx)
      }));
      tdActions.appendChild(actionsDiv);
      tr.appendChild(tdActions);
      return tr;
    }

    // 获取类型参数
    function getTypeParam(type) {
      const match = type.match(/\((.*?)\)/);
      return match ? match[1] : '';
    }

    // 更新字段类型
    function updateFieldType(entityIdx, fieldIdx, type) {
      const field = configTableData[entityIdx].fields[fieldIdx];
      if (type === 'BigDecimal') {
        field.type = 'BigDecimal(10,2)'; // 强制BigDecimal为两个参数
      } else if (type === 'String') {
        field.type = 'String()'; // String 不带默认参数
        // 自动填充参数为100
        setTimeout(() => {
          const container = document.getElementById('configTableContainer');
          const tables = container.querySelectorAll('.fields-table');
          if (!tables[entityIdx]) return;
          const tbody = tables[entityIdx].querySelector('tbody');
          const trs = Array.from(tbody.querySelectorAll('tr'));
          const tr = trs[fieldIdx];
          if (tr) {
            const paramInput = tr.querySelector('.field-type-param');
            if (paramInput && !paramInput.value) {
              paramInput.value = '100';
              updateFieldTypeParam(entityIdx, fieldIdx, '100');
            }
          }
        }, 0);
      } else if (type === 'LocalDateTime') {
        field.type = 'LocalDateTime(yyyy-MM-dd HH:mm:ss)';
      } else if (type === 'Boolean') {
        field.type = 'Boolean';
      } else {
        field.type = `${type}`;
      }
      syncConfigTableToJson();
      // 只刷新当前行内容，不刷新整个表格
      const container = document.getElementById('configTableContainer');
      const tables = container.querySelectorAll('.fields-table');
      if (!tables[entityIdx]) return;
      const tbody = tables[entityIdx].querySelector('tbody');
      const trs = Array.from(tbody.querySelectorAll('tr'));
      const tr = trs[fieldIdx];
      if (tr) {
        const newTr = createFieldRow(entityIdx, fieldIdx);
        tr.parentNode.replaceChild(newTr, tr);
      }
    }

    // 更新字段类型参数
    function updateFieldTypeParam(entityIdx, fieldIdx, param) {
      const field = configTableData[entityIdx].fields[fieldIdx];
      const type = field.type.split('(')[0];
      if (type === 'Integer' || type === 'Boolean') {
        field.type = type;
      } else {
        field.type = `${type}(${param})`;
      }
      syncConfigTableToJson();
    }

    // 获取默认参数
    function getDefaultParam(type) {
      switch (type) {
        case 'String':
          return '50';
        case 'Long':
          return '20';
        case 'BigDecimal':
          return '10,2';
        case 'LocalDateTime':
          return 'yyyy-MM-dd HH:mm:ss';
        default:
          return '';
      }
    }
    // 表格转JSON
    function syncConfigTableToJson() {
      const obj = {};
      configTableData.forEach(entity => {
        const key = entity.package + '.' + entity.name;
        obj[key] = {
          databases: entity.dbType
        };
        entity.fields.forEach(f => {
          let typeStr = f.type;
          let commentStr = (f.required ? '*' : '') + (f.comment || '');
          obj[key][f.name] = typeStr + ' | ' + commentStr;
        });
      });
      document.getElementById('jsonInput').value = JSON.stringify(obj, null, 2);
    }
    // JSON转表格
    function jsonToConfigTable(json) {
      try {
        const obj = typeof json === 'string' ? JSON.parse(json) : json;
        configTableData = Object.entries(obj).map(([fullName, fieldsObj]) => {
          const [pkg, ...nameArr] = fullName.split('.');
          const entityName = nameArr.pop();
          const entityPkg = [pkg, ...nameArr].join('.');
          const dbType = fieldsObj.databases || 'mysql';
          const fields = Object.entries(fieldsObj).filter(([k]) => k !== 'databases').map(([fname, fval]) => {
            let [type, comment] = (fval || '').split('|').map(s => s.trim());
            let required = comment && comment.startsWith('*');
            if (required) comment = comment.substring(1);
            return {
              name: fname,
              type: type || '',
              comment: comment || '',
              required
            };
          });
          return {
            name: entityName,
            package: entityPkg,
            dbType,
            fields
          };
        });
        renderConfigTable();
      } catch (e) {
        showToast('JSON解析失败', 'error');
      }
    }

    // 显示导入JSON弹窗
    function showImportJsonModal() {
      document.getElementById('importJsonModal').style.display = 'flex';
    }

    // 从文本导入JSON
    function importJsonFromText() {
      const jsonText = document.getElementById('importJsonInput').value;
      try {
        JSON.parse(jsonText); // 先校验 JSON 格式
        jsonToConfigTable(jsonText);
        showToast('导入成功');
        closeModal('importJsonModal');
      } catch (e) {
        showToast('导入失败：' + e.message, 'error');
      }
    }

    // 复制JSON到剪贴板
    function copyJsonToClipboard() {
      syncConfigTableToJson();
      const json = document.getElementById('jsonInput').value;
      navigator.clipboard.writeText(json).then(() => {
        showToast('已复制到剪贴板');
      }).catch(() => {
        showToast('复制失败', 'error');
      });
    }
    // 复制实体的JSON配置
    function copyEntityJson(entityIdx) {
      const entity = configTableData[entityIdx];
      const obj = {};
      const key = entity.package + '.' + entity.name;
      obj[key] = {
        databases: entity.dbType
      };
      entity.fields.forEach(f => {
        let typeStr = f.type;
        let commentStr = (f.required ? '*' : '') + (f.comment || '');
        obj[key][f.name] = typeStr + ' | ' + commentStr;
      });
      const json = JSON.stringify(obj, null, 2);
      navigator.clipboard.writeText(json).then(() => {
        showToast('已复制到剪贴板');
      }).catch(() => {
        showToast('复制失败', 'error');
      });
    }
    // 说明弹窗
    function showInstructionModal() {
      const modal = document.getElementById('instructionModal');
      const body = document.getElementById('instructionModalBody');

      // 直接使用HTML中的说明内容，现在已包含快捷键说明
      body.innerHTML = document.getElementById('rulesListContent').innerHTML;
      modal.style.display = 'flex';
    }
    // 页面加载时初始化
    window.addEventListener('DOMContentLoaded', function () {
      renderConfigTable(); // 页面加载时自动渲染表格，显示新建按钮
    });

    // 删除当前配置
    let configToDelete = '';
    function deleteCurrentConfig() {
      const header = document.querySelector('#mainConfigSelector .config-select-header');
      const currentName = header ? header.textContent : '';
      if (!currentName || currentName === '新配置') {
        showToast('当前无可删除的配置。', 'warning');
        return;
      }
      configToDelete = currentName;
      document.getElementById('deleteConfigModalBody').textContent = `确定要删除配置"${currentName}"吗？`;
      openModal('deleteConfigModal');
    }
    document.getElementById('deleteConfigModalConfirmBtn').onclick = function () {
      if (!configToDelete) return;
      const projects = JSON.parse(localStorage.getItem('codeGeneratorProjects') || '{}');
      if (projects[configToDelete]) {
        delete projects[configToDelete];
        localStorage.setItem('codeGeneratorProjects', JSON.stringify(projects));
        showToast(`已删除配置：${configToDelete}。`);
        // 切换到新配置
        const header = document.querySelector('#mainConfigSelector .config-select-header');
        if (header) header.textContent = '新配置';
        document.getElementById('jsonInput').value = '';
        document.getElementById('result').innerHTML = '';
        document.getElementById('floatingNav').style.display = 'none';
        renderMainConfigSelector();
      }
      closeModal('deleteConfigModal');
      configToDelete = '';
    };

    // 公共按钮组件（升级：支持tooltip和主题色）
    function createButton({
      text,
      type = 'default',
      onClick,
      icon,
      className = '',
      tooltip,
      tooltipPosition = 'top',
      color, // 新增 color 参数
      ...attrs
    }) {
      const btn = document.createElement('button');
      // 判断是否纯图标按钮
      const isIconOnly = icon && !text;
      btn.className = `btn-common btn-${type} ${className}${isIconOnly ? ' icon-only' : ''}`;
      btn.type = 'button';
      if (icon) btn.innerHTML = icon + (text ? `<span>${text}</span>` : '');
      else btn.textContent = text;
      if (onClick) btn.onclick = onClick;
      Object.entries(attrs).forEach(([k, v]) => btn.setAttribute(k, v));
      // 主题色支持
      if (color) {
        let bg, border, font;
        if (color === 'blue') {
          bg = '#2563eb'; border = '#2563eb'; font = '#fff';
        } else if (color === 'green') {
          bg = '#22c55e'; border = '#22c55e'; font = '#fff';
        } else if (color === 'red') {
          bg = '#dc2626'; border = '#dc2626'; font = '#fff';
        } else {
          bg = color; border = color; font = '#fff';
        }
        btn.style.background = bg;
        btn.style.border = `1.5px solid ${border}`;
        btn.style.color = font;
      }
      if (tooltip) {
        const wrapper = document.createElement('div');
        wrapper.className = 'tooltip-container';
        wrapper.appendChild(btn);
        const tip = document.createElement('div');
        tip.className = `tooltip tooltip-${tooltipPosition}`;
        tip.textContent = tooltip;
        wrapper.appendChild(tip);
        // 生成按钮时自动补充.tooltip-error
        if (className && className.includes('generate-btn')) {
          const errorTip = document.createElement('div');
          errorTip.className = 'tooltip tooltip-bottom tooltip-error';
          wrapper.appendChild(errorTip);
        }
        btn.onmouseenter = () => {
          tip.style.opacity = '1';
          tip.style.visibility = 'visible';
        };
        btn.onmouseleave = () => {
          tip.style.opacity = '0';
          tip.style.visibility = 'hidden';
        };
        return wrapper;
      }
      return btn;
    }
    // 公共下拉框组件
    function createSelect({
      options,
      value,
      onChange,
      className = '',
      ...attrs
    }) {
      const select = document.createElement('select');
      select.className = `select-common ${className}`;
      options.forEach(opt => {
        const option = document.createElement('option');
        option.value = opt.value;
        option.textContent = opt.label;
        if (value !== undefined && value == opt.value) option.selected = true;
        select.appendChild(option);
      });
      if (onChange) select.onchange = e => onChange(e.target.value, e);
      Object.entries(attrs).forEach(([k, v]) => select.setAttribute(k, v));
      return select;
    }

    // 渲染顶部操作区按钮
    function renderTopButtons() {
      const group1 = document.createElement('div');
      group1.className = 'button-group';
      group1.appendChild(createButton({
        text: '导入',
        type: 'white',
        onClick: showImportJsonModal,
        tooltip: '导入JSON配置（Ctrl + I）'
      }));
      group1.appendChild(createButton({
        text: '导出',
        type: 'white',
        onClick: copyJsonToClipboard,
        tooltip: '复制JSON配置到剪贴板（Ctrl + E）'
      }));
      // 移除"示例"按钮
      // group1.appendChild(createButton({
      //   text: '示例',
      //   type: 'white',
      //   onClick: generateExampleTable,
      //   tooltip: '点击生成示例配置表格'
      // }));

      const group2 = document.createElement('div');
      group2.className = 'button-group';
      group2.appendChild(createButton({
        text: '模板',
        type: 'white',
        onClick: showTemplateModal,
        tooltip: '查看和修改代码生成模板（Ctrl + T）'
      }));
      group2.appendChild(createButton({
        text: '说明',
        type: 'white',
        onClick: showInstructionModal,
        tooltip: '查看使用说明（Ctrl + H）'
      }));

      const group3 = document.createElement('div');
      group3.className = 'button-group';
      group3.appendChild(createButton({
        text: '删除',
        type: 'danger',
        onClick: deleteCurrentConfig,
        tooltip: '删除当前配置（Ctrl + D）'
      }));
      group3.appendChild(createButton({
        text: '保存',
        type: 'save',
        onClick: showSaveConfigModal,
        tooltip: '保存当前配置和模板（Ctrl + S）'
      }));
      group3.appendChild(createButton({
        text: '生成',
        type: 'primary',
        onClick: generateCode,
        className: 'generate-btn',
        tooltip: '生成代码（Ctrl + Enter）'
      }));

      const buttonGroups = document.querySelector('.button-groups');
      buttonGroups.innerHTML = '';
      buttonGroups.appendChild(group1);
      buttonGroups.appendChild(group2);
      buttonGroups.appendChild(group3);
    }
    // 页面初始化时渲染
    window.addEventListener('DOMContentLoaded', function () {
      renderTopButtons();

      // 显示快捷键提示（仅在首次访问时）
      if (!localStorage.getItem('shortcutHintShown')) {
        setTimeout(() => {
          showToast('💡 提示：使用快捷键可提高效率，按 Ctrl + H 查看完整说明', 'info', 5000);
          localStorage.setItem('shortcutHintShown', 'true');
        }, 2000);
      }

      // ...原有初始化代码...
    });

    // 工具函数：关闭所有下拉弹层（放在JS区合适位置）
    function closeAllConfigDropdowns() {
      document.querySelectorAll('.config-select-options.show').forEach(opt => {
        opt.classList.remove('show');
      });
      document.querySelectorAll('.config-select-header.active').forEach(hd => {
        hd.classList.remove('active');
      });
    }

    // 全局点击事件，点击非下拉区域时自动关闭所有下拉弹层
    if (!window._dropdownGlobalClickBinded) {
      document.addEventListener('click', function (e) {
        if (!e.target.closest('.config-selector')) {
          closeAllConfigDropdowns();
        }
        window._dropdownGlobalClickBinded = true;
      });
    }

    // 添加批量添加默认字段的函数
    function addDefaultFields(entityIdx) {
      const entity = configTableData[entityIdx];
      const names = entity.fields.map(f => f.name);
      const defaultFields = [
        { name: 'delFlag', type: 'BigDecimal(1,0)', comment: '删除标志 (0-存在 1-删除)', required: false },
        { name: 'createBy', type: 'String(50)', comment: '创建人', required: false },
        { name: 'createTime', type: 'LocalDateTime(yyyy-MM-dd HH:mm:ss)', comment: '创建时间', required: false },
        { name: 'updateBy', type: 'String(50)', comment: '更新人', required: false },
        { name: 'updateTime', type: 'LocalDateTime(yyyy-MM-dd HH:mm:ss)', comment: '更新时间', required: false }
      ];
      defaultFields.forEach(f => {
        if (!names.includes(f.name)) entity.fields.push({ ...f });
      });
      renderConfigTable();
    }
  </script>
</body>

</html>